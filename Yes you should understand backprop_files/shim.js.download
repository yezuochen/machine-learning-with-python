var Va=Object.defineProperty;var qa=(ie,ce,xe)=>ce in ie?Va(ie,ce,{enumerable:!0,configurable:!0,writable:!0,value:xe}):ie[ce]=xe;var V=(ie,ce,xe)=>(qa(ie,typeof ce!="symbol"?ce+"":ce,xe),xe);(function(){"use strict";let ie;const ce=new Uint8Array(16);function xe(){if(!ie&&(ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ie))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ie(ce)}const q=[];for(let e=0;e<256;++e)q.push((e+256).toString(16).slice(1));function Zi(e,t=0){return q[e[t+0]]+q[e[t+1]]+q[e[t+2]]+q[e[t+3]]+"-"+q[e[t+4]]+q[e[t+5]]+"-"+q[e[t+6]]+q[e[t+7]]+"-"+q[e[t+8]]+q[e[t+9]]+"-"+q[e[t+10]]+q[e[t+11]]+q[e[t+12]]+q[e[t+13]]+q[e[t+14]]+q[e[t+15]]}const yr={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function We(e,t,n){if(yr.randomUUID&&!t&&!e)return yr.randomUUID();e=e||{};const r=e.random||(e.rng||xe)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=r[i];return t}return Zi(r)}var Ae=(e=>(e.Closed="close.click",e.Complete="survey.completed",e.PageChange="page.change",e.API="api",e.Override="override",e))(Ae||{}),O=(e=>(e.ReplayCapture="replay.capture",e.SDKReady="sdk.ready",e.SurveyAppeared="survey.appeared",e.SurveyClosed="survey.closed",e.SurveyDimensions="survey.dimensions",e.SurveyFadingOut="survey.fadingOut",e.SurveyHeight="survey.height",e.SurveyPresented="survey.presented",e.SurveyLifeCycle="survey.lifeCycle",e.SurveyWidth="survey.width",e.SurveyWillClose="survey.willClose",e.SurveyWillPresent="survey.will.present",e.CloseSurveyOnOverlayClick="close.survey.overlayClick",e.VisitorIDUpdated="visitor.id.updated",e.QuestionAnswered="question.answered",e))(O||{}),It=(e=>(e.SurveyId="survey.id",e))(It||{});const wr={SDK_READY:"sdk.ready",SURVEY_APPEARED:"survey.appeared",SURVEY_CLOSED:"survey.closed",SURVEY_DIMENSIONS:"survey.dimensions",SURVEY_FADING_OUT:"survey.fadingOut",SURVEY_HEIGHT:"survey.height",SURVEY_PRESENTED:"survey.presented",SURVEY_LIFE_CYCLE:"survey.lifeCycle",SURVEY_WILL_CLOSE:"survey.willClose",SURVEY_WILL_PRESENT:"survey.will.present",QUESTION_ANSWERED:"question.answered",REPLAY_CAPTURE:"replay.capture",CLOSE_SURVEY_ON_OVERLAY_CLICK:"close.survey.overlayClick",VISITOR_ID_UPDATED:"visitor.id.updated",DATA:{DISMISS_REASONS:{API:"api",CLOSED:"close.click",COMPLETE:"survey.completed",PAGE_CHANGE:"page.change",OVERRIDE:"override"},SURVEY_ID:"survey.id"}};var on=(e=>(e.VerifyViewVersion="verify.view.version",e.CurrentQuestion="survey.question",e.ViewPrototypeClick="question.prototype.click",e.ViewAgreementClick="question.agreement.click",e.RecordedTaskStart="recorded.task.start",e.RecordedTaskPermissionScreen="recorded.task.permission.screen",e.SurveyComplete="survey.complete",e))(on||{}),gr=(e=>(e.ViewVersion="view.version",e.QuestionId="qid",e.Props="props",e))(gr||{}),es=class extends Error{constructor(e,t,n){super(`Possible EventEmitter memory leak detected. ${n} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=n,this.name="MaxListenersExceededWarning"}},vr=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=vr.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,n){this.emit(e,t,n)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const n=e.indexOf(t);return n>-1&&e.splice(n,1),[]}_wrapOnceListener(e,t){const n=(...r)=>(this.removeListener(e,n),t.apply(this,r));return Object.defineProperty(n,"name",{value:t.name}),n}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const n=this._getListeners(e);return n.forEach(r=>{r.apply(this,t)}),n.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const n=this._getListeners(e).concat(t);if(this.events.set(e,n),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const r=new es(this,e,this.listenerCount(e));console.warn(r)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const n=this._getListeners(e);if(n.length>0){const r=[t].concat(n);this.events.set(e,r)}else this.events.set(e,n.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const n=this._getListeners(e);return n.length>0&&(this._removeListener(n,t),this.events.set(e,n),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},br=vr;br.defaultMaxListeners=10;const P=new br;var st=(e=>(e.BottomLeft="bottomLeft",e.BottomRight="bottomRight",e.Center="center",e.TopLeft="topLeft",e.TopRight="topRight",e))(st||{}),se=(e=>(e.Error="x-ul-error",e.EnvironmentID="x-ul-environment-id",e.InstallationMethod="x-ul-installation-method",e.PartnerAnonymousId="x-ul-anonymous-id",e.Platform="userleap-platform",e.PreviewMode="x-ul-preview-mode",e.UserID="x-ul-user-id",e.VisitorID="x-ul-visitor-id",e))(se||{}),xt=(e=>(e.Email="email",e.Link="link",e.Web="web",e))(xt||{}),$e=(e=>(e.Npm="web-npm",e.NpmBundled="web-npm-bundled",e.Gtm="web-gtm",e.Segment="web-segment",e.SegmentAndroid="android-segment",e.SegmentReactNative="react-native-segment",e.SegmentIOS="ios-segment",e.Snippet="web-snippet",e))($e||{});window.UserLeap&&window.Sprig&&(window.Sprig._gtm?window.Sprig=window.UserLeap:window.UserLeap=window.Sprig),window.UserLeap||(window.UserLeap=window.Sprig),window.Sprig||(window.Sprig=window.UserLeap);const ts="rgba(255,255,255, 0.95)",ns="rgba(0,0,0,0.9)",rs="360px",an="0px",_r=()=>{window.UserLeap.container=document.createElement("div"),window.UserLeap.container.className="ul-container",document.body.appendChild(window.UserLeap.container)},Er=e=>{cs();const t=window.UserLeap.container;if(!(!t||!t.parentNode))try{t.parentNode.removeChild(t),window.UserLeap.container=null,ee("trackStartUrl",null),P.emit(O.SurveyLifeCycle,{state:"dismissed"}),P.emit(O.SurveyClosed,{name:O.SurveyClosed,initiator:e})}catch(n){console.warn(`[Sprig] (ERR-412) Error removing UserLeap container by ${e} `+t),n instanceof Error&&window.UserLeap.reportError("dismissActiveSurvey",n)}},Sr=()=>{P.on(O.SurveyWillClose,({initiator:e})=>{Er(e)})},is=(e,t)=>{const r={...{position:"fixed",overflow:"auto",top:"0px",left:"0px",display:"none",height:"100%",width:"100%",transition:"background-color 0.3s ease-out",zIndex:2147483646}},i=t?e.overlayStyleMobile:e.overlayStyle;r["background-color"]=i==="light"?ts:ns,t||(r.margin="auto"),window.UserLeap.container&&Object.assign(window.UserLeap.container.style,r)},ss=(e,t,n)=>{var a,c;const r={position:"fixed",bottom:"0px",right:an,border:0,backgroundColor:"rgba(0,0,0,0)",zIndex:2147483646,transition:"width 0.2s ease-in-out, height 0.2s ease-in-out"},i=Object.assign({},t,window.UserLeap);let s,o=!1;return n?((a=window.UserLeap.windowDimensions)!=null&&a.width?r.width=`${window.UserLeap.windowDimensions.width}px`:r.width="100%",(c=window.UserLeap.windowDimensions)!=null&&c.height?r.maxHeight=`${window.UserLeap.windowDimensions.height-20}px`:window.UserLeap.maxHeight?r.maxHeight=window.UserLeap.maxHeight:r.maxHeight=`${document.body.clientHeight-20}px`,["light","dark"].includes(i.overlayStyleMobile)&&(o=!0)):(r.width=rs,r.maxHeight=window.UserLeap.maxHeight||"66vh",i.framePosition===st.BottomLeft?s={left:an}:i.framePosition===st.TopLeft?s={left:an,top:0}:i.framePosition===st.TopRight?s={top:0}:i.framePosition===st.Center&&(o=!0,s={margin:"auto",position:"static"},r.maxHeight=null)),o&&is(i,n),Object.assign(e.style,r,s),o},os=(e,t,n)=>{var c,u;const r="ul-frame";_r(),as();const i=document.createElement("iframe");i.id=r,i.setAttribute("title","Sprig User Feedback Dialog");const s=ss(i,e,t);Sr(),i.setHeight=l=>{parseInt(i.style.height)!=l&&(i.style.height=`${l}px`,P.emit(O.SurveyHeight,{name:O.SurveyHeight,contentFrameHeight:l}))},i.setWidth=l=>{parseInt(i.style.width)!=l&&(i.style.width=`${l}px`,P.emit(O.SurveyWidth,{name:O.SurveyWidth,contentFrameWidth:l}))},(c=window.UserLeap.container)==null||c.appendChild(i),e&&(t?e.exitOnOverlayClickMobile:e.exitOnOverlayClick)&&window.UserLeap.container&&(window.UserLeap.container.onclick=()=>{P.emit(O.CloseSurveyOnOverlayClick)}),P.emit(O.SurveyLifeCycle,{state:"presented"}),P.emit(O.SurveyPresented,{name:O.SurveyPresented,[It.SurveyId]:n});const o=(u=i.contentWindow)==null?void 0:u.document;o&&(o.open("text/html","replace"),o.write("<!doctype html><head></head><body></body></html>"),o.close());const a=o==null?void 0:o.head;return{frameId:r,contentWinDocHead:a,contentWindow:i.contentWindow,hasOverlay:s,iframe:i}},Lr={[O.SurveyFadingOut]:()=>{window.UserLeap.container&&Object.assign(window.UserLeap.container.style,{"background-color":"rgba(0,0,0,0)"})}},as=()=>{Object.entries(Lr).forEach(([e,t])=>{P.on(e,t)})},cs=()=>{Object.entries(Lr).forEach(([e,t])=>{P.off(e,t)})},ls="!launch_darkly_";class us{constructor(){V(this,"_ldData",{})}getAllLaunchDarklyVariations(){return this._ldData}setLDFlagsVariations(t){try{return!t||typeof t!="object"||Array.isArray(t)?!1:(Object.keys(this._ldData).forEach(n=>{delete this._ldData[n]}),Object.keys(t).forEach(n=>this._ldData[`${ls}${n}`]=(t[n]??0)+1),!0)}catch(n){return n instanceof Error&&window.UserLeap.reportError("setAllLDFlagsVariations",n),console.warn("[Sprig] An issue had occured when setting LaunchDarkly flags and variations."),!1}}}const cn=new us;Object.freeze(cn);const ds="!optimizely_experiments_";class hs{constructor(){V(this,"_optimizelyData",{})}setOptimizelyExperiment(t,n=!0){if(!t||typeof t!="object")return!1;const{experiments:r}=t;try{return n&&Object.keys(this._optimizelyData).map(i=>{delete this._optimizelyData[i]}),r&&r.map(i=>{const{id:s,variation:o}=i,a=this.transformExperimentId(s);o&&typeof o=="string"&&(this._optimizelyData[a]=o)}),!0}catch(i){return i instanceof Error&&window.UserLeap.reportError("setOptimizelyExperiment",i),!1}}getAllOptimizelyExperiments(){return this._optimizelyData}getOptimizelyVariationName(t){return this._optimizelyData[this.transformExperimentId(t)]}transformExperimentId(t){return ds+t}getAndSetWebOptimizelyExperiments(){var t;try{if(window&&window.optimizely&&typeof window.optimizely.get=="function"){const n=(t=window.optimizely.get("state"))==null?void 0:t.getExperimentStates({isActive:!0});if(n){const r=Object.keys(n).map(i=>{var s,o;return(s=n[i].variation)!=null&&s.name?{id:i,variation:(o=n[i].variation)==null?void 0:o.name}:{id:i,variation:"Original"}});return this.setOptimizelyExperiment({experiments:r},!1),!0}return!1}return!1}catch(n){return n instanceof Error&&window.UserLeap.reportError("getAndSetWebOptimizely",n),!1}}}const At=new hs;Object.freeze(At);class ps{constructor(t,n){V(this,"paused");V(this,"queue");V(this,"ul");this.ul=t,this.paused=!1,this.queue=[],this.flush(n)}flush(t){const n=t.length;if(n)for(let r=0;r<n;r++)this.push(t[r])}isPaused(){return this.paused}pause(){this.paused=!0}unpause(){this.paused=!1;const t=this.queue.slice();this.empty(),this.flush(t)}push(t){if(this.paused)this.queue.push(t);else if(t instanceof Function)t();else{const n=Array.prototype.slice.call(t,1),r=t[0],i=this.ul[r];i instanceof Function?i.apply(this.ul,n):r&&console.warn("[Sprig] (ERR-100) No valid UserLeap action called",r)}}perform(t){if(this.paused){let n=()=>{};const r=new Promise(function(i){n=function(){i(t())}});return this.queue.push(n),r}else return t()}empty(){this.queue.length=0}}var te=(e=>(e.Ready="ready",e.NoSurvey="no survey",e))(te||{}),kr=(e=>(e.Preview="sprigPreviewKey",e))(kr||{}),Ot=(e=>(e.Caption="ul-caption",e.CardContainer="ul-card__container",e.CardMainContent="ul-card-main-content",e.Choice="choice",e.ChoiceCheckbox="select-checkbox",e.ChoiceGroup="ul-card__choices",e.ChoiceLabel="select-label",e.ChoiceLabelContainer="choice-label-container",e.ChoiceRadio="select-radio",e.ChoiceTextEntryContainer="choice-text-entry-container",e.ChoiceTextInput="choice-text-input",e.CloseButton="close-btn",e.CloseContainer="close-container",e.ConsentLegalNameInput="ul-consent-legal__name-input",e.CustomStyle="ul-custom-style",e.DesktopSuffix="--desktop",e.FadeInTransition="fade-in-transition",e.LikertNumber="likert-number",e.LikertSmiley="likert-smiley",e.LikertStar="likert-star",e.LoadingSpinner="ul-loading-spinner",e.LoadingSpinnerContainer="ul-loading-spinner-container",e.LoadingSpinnerFirst="first",e.LoadingSpinnerFourth="fourth",e.LoadingSpinnerSecond="second",e.LoadingSpinnerThird="third",e.MobileSuffix="--mobile",e.NPSNumber="nps-number",e.OpenTextInput="ul-card-text__input",e.QuestionHeader="ul-question",e.VideoCard="ul-card--video",e.CheckmarkButton="ul-button-checkmark",e.InactiveButton="ul-button-inactive",e.LeftAlignButton="ul-button-left-align",e.ButtonDisabled="sprig-button-disabled",e.SkipButton="ul-card-skip__button",e))(Ot||{});const fs=500;var Ur=(e=>(e.Video="video",e.Audio="audio",e.Screen="screen",e))(Ur||{}),Q=(e=>(e.Preview="sprig.previewKey",e.Credentials="userleap.ids",e.PageViews="userleap.pageviews",e))(Q||{});const Ir=()=>{try{return window.parent.Intercom}catch(e){return console.error(e),null}},xr=[Object.freeze(Object.defineProperty({__proto__:null,disable:()=>{const e=Ir();e&&(e.ul_wasVisible=!!document.querySelector("iframe.intercom-launcher-frame"),e.ul_wasVisible&&e("update",{hide_default_launcher:!0}))},enable:()=>{const e=Ir();e&&(e.ul_wasVisible&&e("update",{hide_default_launcher:!1}),delete e.ul_wasVisible)}},Symbol.toStringTag,{value:"Module"}))];class ms{static disable(){xr.forEach(t=>t.disable())}static enable(){xr.forEach(t=>t.enable())}}const ys=1,Ar=e=>e instanceof HTMLElement||e instanceof SVGElement,ws=(e,t,n)=>{const r=e.createElement("style");n&&(r.nonce=n),r.textContent=t,r.id=Ot.CustomStyle,e.head.appendChild(r)},gs=()=>{try{return window.parent.innerWidth}catch{return window.innerWidth}},vs=e=>{const t=e.querySelector(`.${Ot.CardContainer}`);let n=600,r=360;if(t){n=t.scrollHeight;const i=getComputedStyle(t),s=parseFloat(i.marginTop)+parseFloat(i.marginBottom),o=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth);n+=s+o,r=t.scrollWidth;const a=parseFloat(i.marginLeft)+parseFloat(i.marginRight),c=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth);r+=a+c}return[n+ys,Math.min(r,gs())]},Pt=e=>new Promise(t=>{setTimeout(()=>{t()},e)}),bs=({"userleap-platform":e})=>e!==xt.Web;class Or{constructor(t){V(this,"storage");V(this,"tempStorage",{});V(this,"isStorageAvailable");this.storage=window[t],this.isStorageAvailable=this.checkIfStorageAvailable()}checkIfStorageAvailable(){try{const t="__storage_test__";return this.storage.setItem(t,t),this.storage.removeItem(t),!0}catch{return!1}}setItem(t,n){this.isStorageAvailable?this.storage.setItem(t,n):this.tempStorage[t]=n}getItem(t){return this.isStorageAvailable?this.storage.getItem(t):this.tempStorage[t]}removeItem(t){this.isStorageAvailable?this.storage.removeItem(t):delete this.tempStorage[t]}clear(){this.isStorageAvailable?this.storage.clear():this.tempStorage={}}}const ge=new Or("sessionStorage"),J=new Or("localStorage");class _s{constructor(t){V(this,"payload");V(this,"promise");V(this,"reject",()=>{});V(this,"resolve",()=>{});this.payload=t,this.promise=new Promise((n,r)=>{this.reject=r,this.resolve=n})}resolveRequest(t){this.resolve(t)}}const Es={RATELIMIT_RESET_DEFAULT:10};let Pr=!1,Rr="",Rt=!1,Dr=!1,Dt=[];const Ss=e=>e._config&&e._config.installationMethod?e._config.installationMethod:e._gtm?$e.Gtm:e._segment?$e.Segment:$e.Snippet,ln=e=>{var t;(t=e==null?void 0:e.blockedURI)!=null&&t.includes(window.UserLeap._API_URL)&&(Dr=!0,console.warn(`[Sprig] ${e.blockedURI} is blocked by Content-Security-Policy`),document.removeEventListener("securitypolicyviolation",ln))},un=(e="")=>{Pr=!0,Rr=e};function ze(e={}){const t={"Content-Type":"application/json","userleap-platform":xt.Web,"x-ul-sdk-version":"2.26.2",[se.InstallationMethod]:Ss(e)};if(e.envId&&(t[se.EnvironmentID]=e.envId),e.token&&(t.Authorization="Bearer "+e.token),e.userId&&(t[se.UserID]=e.userId),e.visitorId&&(t[se.VisitorID]=e.visitorId),e.partnerAnonymousId&&(t[se.PartnerAnonymousId]=e.partnerAnonymousId),e.mobileHeadersJSON){const n=JSON.parse(e.mobileHeadersJSON);Object.assign(t,n)}return e.locale&&(t["accept-language"]=e.locale),window.previewMode&&(t[se.PreviewMode]="1"),t}const Cr=async(e,t,n)=>{if(e)return{status:429};{const r=new _s(n);return Dt.push(r),r.promise}},He=async(e,t,n=0,r=!1,i=!1)=>{const s={url:e,options:t,attempt:n,shouldDropOnRateLimit:r};if(Rt&&!i)return Cr(r,i,s);const o={ok:!1,reportError:!1};if(Pr)return console.info(`UserLeap - ${Rr}`),o;try{t.headers=Object.assign(ze(),t.headers);const a=await fetch(e,t);if(a.status===429)if(!Rt&&!r||i){Rt=!0;const u=a.headers.has("ratelimit-reset")?Number(a.headers.get("ratelimit-reset")):Es.RATELIMIT_RESET_DEFAULT;return await Pt(u*1e3),He(e,t,0,r,!0)}else return Cr(r,!1,s);if(Rt=!1,Dt.length&&(Dt.map(c=>{const{url:u,options:l,attempt:h,shouldDropOnRateLimit:d}=c.payload;He(u,l,h,d).then(f=>{c.resolveRequest(f)})}),Dt=[]),a.ok){if(a.status===249)return un(),o;const c=await a.text();try{return c&&c!=="OK"&&(a.json=JSON.parse(c)),a}catch{return{ok:!1,reportError:!1,error:new Error(`failed parsing response json for ${e} - ${c}`)}}}return a}catch(a){const c=n+1;return c>5||Dr?{ok:!1,reportError:!1,error:a}:(await Pt(Math.pow(2,n)*1e3),He(e,t,c))}};var Ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ks(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Tr={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Ls,function(){var n=function(s,o){if(o=o||{},typeof s!="function")throw new i("fetch must be a function");if(typeof o!="object")throw new i("defaults must be an object");if(o.retries!==void 0&&!r(o.retries))throw new i("retries must be a positive integer");if(o.retryDelay!==void 0&&!r(o.retryDelay)&&typeof o.retryDelay!="function")throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(o.retryOn!==void 0&&!Array.isArray(o.retryOn)&&typeof o.retryOn!="function")throw new i("retryOn property expects an array or function");var a={retries:3,retryDelay:1e3,retryOn:[]};return o=Object.assign(a,o),function(u,l){var h=o.retries,d=o.retryDelay,f=o.retryOn;if(l&&l.retries!==void 0)if(r(l.retries))h=l.retries;else throw new i("retries must be a positive integer");if(l&&l.retryDelay!==void 0)if(r(l.retryDelay)||typeof l.retryDelay=="function")d=l.retryDelay;else throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(l&&l.retryOn)if(Array.isArray(l.retryOn)||typeof l.retryOn=="function")f=l.retryOn;else throw new i("retryOn property expects an array or function");return new Promise(function(w,m){var g=function(p){var v=typeof Request<"u"&&u instanceof Request?u.clone():u;s(v,l).then(function(b){if(Array.isArray(f)&&f.indexOf(b.status)===-1)w(b);else if(typeof f=="function")try{return Promise.resolve(f(p,null,b)).then(function(_){_?y(p,null,b):w(b)}).catch(m)}catch(_){m(_)}else p<h?y(p,null,b):w(b)}).catch(function(b){if(typeof f=="function")try{Promise.resolve(f(p,b,null)).then(function(_){_?y(p,b,null):m(b)}).catch(function(_){m(_)})}catch(_){m(_)}else p<h?y(p,b,null):m(b)})};function y(p,v,b){var _=typeof d=="function"?d(p,v,b):d;setTimeout(function(){g(++p)},_)}g(0)})}};function r(s){return Number.isInteger(s)&&s>=0}function i(s){this.name="ArgumentError",this.message=s}return n})})(Tr);var Us=Tr.exports;const Is=ks(Us);class xs{constructor(t){V(this,"awaitingResolvers",[]);V(this,"activeCount",0);this.capacity=t}async acquire(){if(this.activeCount<this.capacity){this.activeCount++;return}return new Promise(t=>{this.awaitingResolvers.push(t)})}release(){const t=this.awaitingResolvers.shift();t&&this.activeCount<=this.capacity?t():this.activeCount--}async execute(t){try{return await this.acquire(),await t()}finally{this.release()}}setLimit(t){this.capacity=t}}const Kr=new xs(2),As=e=>Kr.setLimit(e),Os=Is(fetch),Ps=async(e,t=3)=>Kr.execute(async()=>{const r=(await Os(e.uploadUrl,{body:e.data,method:"PUT",retries:t,retryDelay:i=>Math.pow(2,i)*1e3})).headers.get("ETag");if(!r)throw new Error(`Upload response did not include etag for upload ${e.uploadId}, part ${e.chunkIndex}`);return r}),jr=async({apiUrl:e,surveyId:t,uploadId:n,etags:r,headers:i,responseGroupUuid:s,replayDuration:o,eventDigest:a},c=!1)=>{var u;if(!(!c&&!n&&!r))return He(`${e}/sdk/1/completeSessionReplay`,{method:"POST",body:JSON.stringify({etags:r,uploadId:n,responseGroupUuid:s,surveyId:t,replayDuration:o,eventDigest:a,userAgent:(u=window==null?void 0:window.navigator)==null?void 0:u.userAgent}),headers:i})},K=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,B=Object.keys,W=Array.isArray;function z(e,t){return typeof t!="object"||B(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||K.Promise||(K.Promise=Promise);const ot=Object.getPrototypeOf,Rs={}.hasOwnProperty;function X(e,t){return Rs.call(e,t)}function Ge(e,t){typeof t=="function"&&(t=t(ot(e))),(typeof Reflect>"u"?B:Reflect.ownKeys)(t).forEach(n=>{le(e,n,t[n])})}const Br=Object.defineProperty;function le(e,t,n,r){Br(e,t,z(n&&X(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Ye(e){return{from:function(t){return e.prototype=Object.create(t.prototype),le(e.prototype,"constructor",e),{extend:Ge.bind(null,e.prototype)}}}}const Ds=Object.getOwnPropertyDescriptor;function dn(e,t){let n;return Ds(e,t)||(n=ot(e))&&dn(n,t)}const Cs=[].slice;function Ct(e,t,n){return Cs.call(e,t,n)}function Nr(e,t){return t(e)}function at(e){if(!e)throw new Error("Assertion Failed")}function Fr(e){K.setImmediate?setImmediate(e):setTimeout(e,0)}function Mr(e,t){return e.reduce((n,r,i)=>{var s=t(r,i);return s&&(n[s[0]]=s[1]),n},{})}function ue(e,t){if(X(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var s=ue(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(o!==-1){var a=e[t.substr(0,o)];return a===void 0?void 0:ue(a,t.substr(o+1))}}function ne(e,t,n){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){at(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)ne(e,t[r],n[r])}else{var s=t.indexOf(".");if(s!==-1){var o=t.substr(0,s),a=t.substr(s+1);if(a==="")n===void 0?W(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var c=e[o];c&&X(e,o)||(c=e[o]={}),ne(c,a,n)}}else n===void 0?W(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Vr(e){var t={};for(var n in e)X(e,n)&&(t[n]=e[n]);return t}const Ts=[].concat;function qr(e){return Ts.apply([],e)}const Wr="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(qr([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>K[e]),Ks=Wr.map(e=>K[e]);Mr(Wr,e=>[e,!0]);let ve=null;function ct(e){ve=typeof WeakMap<"u"&&new WeakMap;const t=hn(e);return ve=null,t}function hn(e){if(!e||typeof e!="object")return e;let t=ve&&ve.get(e);if(t)return t;if(W(e)){t=[],ve&&ve.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(hn(e[n]))}else if(Ks.indexOf(e.constructor)>=0)t=e;else{const s=ot(e);for(var i in t=s===Object.prototype?{}:Object.create(s),ve&&ve.set(e,t),e)X(e,i)&&(t[i]=hn(e[i]))}return t}const{toString:js}={};function pn(e){return js.call(e).slice(8,-1)}const fn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Bs=typeof fn=="symbol"?function(e){var t;return e!=null&&(t=e[fn])&&t.apply(e)}:function(){return null},Qe={};function de(e){var t,n,r,i;if(arguments.length===1){if(W(e))return e.slice();if(this===Qe&&typeof e=="string")return[e];if(i=Bs(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const mn=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var oe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function $r(e,t){oe=e,zr=t}var zr=()=>!0;const Ns=!new Error("").stack;function Oe(){if(Ns)try{throw Oe.arguments,new Error}catch(e){return e}return new Error}function yn(e,t){var n=e.stack;return n?(t=t||0,n.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),n.split(`
`).slice(t).filter(zr).map(r=>`
`+r).join("")):""}var Hr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],wn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Hr),Fs={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Je(e,t){this._e=Oe(),this.name=e,this.message=t}function Gr(e,t){return e+". Errors: "+Object.keys(t).map(n=>t[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function Tt(e,t,n,r){this._e=Oe(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Gr(e,t)}function lt(e,t){this._e=Oe(),this.name="BulkError",this.failures=Object.keys(t).map(n=>t[n]),this.failuresByPos=t,this.message=Gr(e,t)}Ye(Je).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+yn(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Ye(Tt).from(Je),Ye(lt).from(Je);var gn=wn.reduce((e,t)=>(e[t]=t+"Error",e),{});const Ms=Je;var I=wn.reduce((e,t)=>{var n=t+"Error";function r(i,s){this._e=Oe(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Fs[t]||n,this.inner=null)}return Ye(r).from(Ms),e[t]=r,e},{});I.Syntax=SyntaxError,I.Type=TypeError,I.Range=RangeError;var Yr=Hr.reduce((e,t)=>(e[t+"Error"]=I[t],e),{}),Kt=wn.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=I[t]),e),{});function C(){}function ut(e){return e}function Vs(e,t){return e==null||e===ut?t:function(n){return t(e(n))}}function Pe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function qs(e,t){return e===C?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Pe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Pe(i,this.onerror):i),s!==void 0?s:n}}function Ws(e,t){return e===C?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Pe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Pe(r,this.onerror):r)}}function $s(e,t){return e===C?t:function(n){var r=e.apply(this,arguments);z(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Pe(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Pe(s,this.onerror):s),r===void 0?o===void 0?void 0:o:z(r,o)}}function zs(e,t){return e===C?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function vn(e,t){return e===C?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return t.apply(r,s)})}return t.apply(this,arguments)}}Kt.ModifyError=Tt,Kt.DexieError=Je,Kt.BulkError=lt;var dt={};const Qr=100,[bn,jt,_n]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,ot(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,ot(t),e]})(),Jr=jt&&jt.then,Bt=bn&&bn.constructor,En=!!_n;var Sn=!1,Hs=_n?()=>{_n.then(Vt)}:K.setImmediate?setImmediate.bind(null,Vt):K.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{Vt(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Vt,0)},ht=function(e,t){pt.push([e,t]),Nt&&(Hs(),Nt=!1)},Ln=!0,Nt=!0,Re=[],Ft=[],kn=null,Un=ut,Xe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ai,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{ai(e[0],e[1])}catch{}})}},U=Xe,pt=[],De=0,Mt=[];function k(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=C,this._lib=!1;var t=this._PSD=U;if(oe&&(this._stackHolder=Oe(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==dt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&xn(this,this._value))}this._state=null,this._value=null,++t.ref,Zr(this,e)}const In={get:function(){var e=U,t=$t;function n(r,i){var s=!e.global&&(e!==U||t!==$t);const o=s&&!he();var a=new k((c,u)=>{An(this,new Xr(Ht(r,e,s,o),Ht(i,e,s,o),c,u,e))});return oe&&ni(a,this),a}return n.prototype=dt,n},set:function(e){le(this,"then",e&&e.prototype===dt?In:{get:function(){return e},set:In.set})}};function Xr(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}function Zr(e,t){try{t(n=>{if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&ft();n&&typeof n.then=="function"?Zr(e,(i,s)=>{n instanceof k?n._then(i,s):n.then(i,s)}):(e._state=!0,e._value=n,ei(e)),r&&mt()}},xn.bind(null,e))}catch(n){xn(e,n)}}function xn(e,t){if(Ft.push(t),e._state===null){var n=e._lib&&ft();t=Un(t),e._state=!1,e._value=t,oe&&t!==null&&typeof t=="object"&&!t._promise&&function(r,i,s){try{r.apply(null,s)}catch(o){i&&i(o)}}(()=>{var r=dn(t,"stack");t._promise=e,le(t,"stack",{get:()=>Sn?r&&(r.get?r.get.apply(t):r.value):e.stack})}),function(r){Re.some(i=>i._value===r._value)||Re.push(r)}(e),ei(e),n&&mt()}}function ei(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)An(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),De===0&&(++De,ht(()=>{--De==0&&On()},[]))}function An(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++De,ht(Gs,[n,e,t])}else e._listeners.push(t)}function Gs(e,t,n){try{kn=t;var r,i=t._value;t._state?r=e(i):(Ft.length&&(Ft=[]),r=e(i),Ft.indexOf(i)===-1&&function(s){for(var o=Re.length;o;)if(Re[--o]._value===s._value)return void Re.splice(o,1)}(t)),n.resolve(r)}catch(s){n.reject(s)}finally{kn=null,--De==0&&On(),--n.psd.ref||n.psd.finalize()}}function ti(e,t,n){if(t.length===n)return t;var r="";if(e._state===!1){var i,s,o=e._value;o!=null?(i=o.name||"Error",s=o.message||o,r=yn(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+r)}return oe&&((r=yn(e._stackHolder,2))&&t.indexOf(r)===-1&&t.push(r),e._prev&&ti(e._prev,t,n)),t}function ni(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Vt(){ft()&&mt()}function ft(){var e=Ln;return Ln=!1,Nt=!1,e}function mt(){var e,t,n;do for(;pt.length>0;)for(e=pt,pt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(pt.length>0);Ln=!0,Nt=!0}function On(){var e=Re;Re=[],e.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var t=Mt.slice(0),n=t.length;n;)t[--n]()}function qt(e){return new k(dt,!1,e)}function j(e,t){var n=U;return function(){var r=ft(),i=U;try{return _e(n,!0),e.apply(this,arguments)}catch(s){t&&t(s)}finally{_e(i,!1),r&&mt()}}}Ge(k.prototype,{then:In,_then:function(e,t){An(this,new Xr(null,null,e,t,U))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,r=>r instanceof t?n(r):qt(r)):this.then(null,r=>r&&r.name===t?n(r):qt(r))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),qt(t)))},stack:{get:function(){if(this._stack)return this._stack;try{Sn=!0;var e=ti(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Sn=!1}}},timeout:function(e,t){return e<1/0?new k((n,r)=>{var i=setTimeout(()=>r(new I.Timeout(t)),e);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&le(k.prototype,Symbol.toStringTag,"Dexie.Promise"),Xe.env=ri(),Ge(k,{all:function(){var e=de.apply(null,arguments).map(zt);return new k(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach((i,s)=>k.resolve(i).then(o=>{e[s]=o,--r||t(e)},n))})},resolve:e=>{if(e instanceof k)return e;if(e&&typeof e.then=="function")return new k((n,r)=>{e.then(n,r)});var t=new k(dt,!0,e);return ni(t,kn),t},reject:qt,race:function(){var e=de.apply(null,arguments).map(zt);return new k((t,n)=>{e.map(r=>k.resolve(r).then(t,n))})},PSD:{get:()=>U,set:e=>U=e},totalEchoes:{get:()=>$t},newPSD:be,usePSD:et,scheduler:{get:()=>ht,set:e=>{ht=e}},rejectionMapper:{get:()=>Un,set:e=>{Un=e}},follow:(e,t)=>new k((n,r)=>be((i,s)=>{var o=U;o.unhandleds=[],o.onunhandled=s,o.finalize=Pe(function(){(function(a){function c(){a(),Mt.splice(Mt.indexOf(c),1)}Mt.push(c),++De,ht(()=>{--De==0&&On()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),e()},t,n,r))}),Bt&&(Bt.allSettled&&le(k,"allSettled",function(){const e=de.apply(null,arguments).map(zt);return new k(t=>{e.length===0&&t([]);let n=e.length;const r=new Array(n);e.forEach((i,s)=>k.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||t(r)))})}),Bt.any&&typeof AggregateError<"u"&&le(k,"any",function(){const e=de.apply(null,arguments).map(zt);return new k((t,n)=>{e.length===0&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach((s,o)=>k.resolve(s).then(a=>t(a),a=>{i[o]=a,--r||n(new AggregateError(i))}))})}));const $={awaits:0,echoes:0,id:0};var Ys=0,Wt=[],Pn=0,$t=0,Qs=0;function be(e,t,n,r){var i=U,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Qs;var o=Xe.env;s.env=En?{Promise:k,PromiseProp:{value:k,configurable:!0,writable:!0},all:k.all,race:k.race,allSettled:k.allSettled,any:k.any,resolve:k.resolve,reject:k.reject,nthen:si(o.nthen,s),gthen:si(o.gthen,s)}:{},t&&z(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=et(s,e,n,r);return s.ref===0&&s.finalize(),a}function Ze(){return $.id||($.id=++Ys),++$.awaits,$.echoes+=Qr,$.id}function he(){return!!$.awaits&&(--$.awaits==0&&($.id=0),$.echoes=$.awaits*Qr,!0)}function zt(e){return $.echoes&&e&&e.constructor===Bt?(Ze(),e.then(t=>(he(),t),t=>(he(),N(t)))):e}function Js(e){++$t,$.echoes&&--$.echoes!=0||($.echoes=$.id=0),Wt.push(U),_e(e,!0)}function Xs(){var e=Wt[Wt.length-1];Wt.pop(),_e(e,!1)}function _e(e,t){var n=U;if((t?!$.echoes||Pn++&&e===U:!Pn||--Pn&&e===U)||ii(t?Js.bind(null,e):Xs),e!==U&&(U=e,n===Xe&&(Xe.env=ri()),En)){var r=Xe.env.Promise,i=e.env;jt.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(K,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function ri(){var e=K.Promise;return En?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(K,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:jt.then,gthen:e.prototype.then}:{}}function et(e,t,n,r,i){var s=U;try{return _e(e,!0),t(n,r,i)}finally{_e(s,!1)}}function ii(e){Jr.call(bn,e)}function Ht(e,t,n,r){return typeof e!="function"?e:function(){var i=U;n&&Ze(),_e(t,!0);try{return e.apply(this,arguments)}finally{_e(i,!1),r&&ii(he)}}}function si(e,t){return function(n,r){return e.call(this,Ht(n,t),Ht(r,t))}}(""+Jr).indexOf("[native code]")===-1&&(Ze=he=C);const oi="unhandledrejection";function ai(e,t){var n;try{n=t.onuncatched(e)}catch{}if(n!==!1)try{var r,i={promise:t,reason:e};if(K.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(oi,!0,!0),z(r,i)):K.CustomEvent&&z(r=new CustomEvent(oi,{detail:i}),i),r&&K.dispatchEvent&&(dispatchEvent(r),!K.PromiseRejectionEvent&&K.onunhandledrejection))try{K.onunhandledrejection(r)}catch{}oe&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var N=k.reject;function Rn(e,t,n,r){if(e.idbdb&&(e._state.openComplete||U.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===gn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>Rn(e,t,n,r))):N(s)}return i._promise(t,(s,o)=>be(()=>(U.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(e._state.openComplete)return N(new I.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return N(new I.DatabaseClosed);e.open().catch(C)}return e._state.dbReadyPromise.then(()=>Rn(e,t,n,r))}const ci="3.2.4",Ce="￿",Dn=-1/0,pe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",li="String expected.",yt=[],Gt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Zs=Gt,eo=Gt,ui=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Yt="__dbnames",Cn="readonly",Tn="readwrite";function Te(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const di={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Qt(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=ct(t))[e],t)}class to{_trans(t,n,r){const i=this._tx||U.trans,s=this.name;function o(c,u,l){if(!l.schema[s])throw new I.NotFound("Table "+s+" not part of transaction");return n(l.idbtrans,l)}const a=ft();try{return i&&i.db===this.db?i===U.trans?i._promise(t,o,r):be(()=>i._promise(t,o,r),{trans:i,transless:U.transless||U}):Rn(this.db,t,[this.name],o)}finally{a&&mt()}}get(t,n){return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:t}).then(i=>this.hook.reading.fire(i))).then(n)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(W(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const n=B(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&n.every(l=>u.keyPath.indexOf(l)>=0)&&u.keyPath.every(l=>n.indexOf(l)>=0))[0];if(r&&this.db._maxKey!==Ce)return this.where(r.name).equals(r.keyPath.map(u=>t[u]));!r&&oe&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,l){try{return s.cmp(u,l)===0}catch{return!1}}const[a,c]=n.reduce(([u,l],h)=>{const d=i[h],f=t[h];return[u||d,u||!d?Te(l,d&&d.multi?w=>{const m=ue(w,h);return W(m)&&m.some(g=>o(f,g))}:w=>o(f,ue(w,h))):l]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(c):r?this.filter(c):this.where(n).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,W(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const n=r=>{if(!r)return r;const i=Object.create(t.prototype);for(var s in r)if(X(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t}defineClass(){return this.mapToClass(function(t){z(this,t)})}add(t,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=t;return i&&r&&(s=Qt(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[s]})).then(o=>o.numFailures?k.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{ne(t,i,o)}catch{}return o})}update(t,n){if(typeof t!="object"||W(t))return this.where(":id").equals(t).modify(n);{const r=ue(t,this.schema.primKey.keyPath);if(r===void 0)return N(new I.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?B(n).forEach(i=>{ne(t,i,n[i])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(t,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=t;return i&&r&&(s=Qt(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:n!=null?[n]:null})).then(o=>o.numFailures?k.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{ne(t,i,o)}catch{}return o})}delete(t){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[t]})).then(n=>n.numFailures?k.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:di})).then(t=>t.numFailures?k.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",n=>this.core.getMany({keys:t,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:c}=this.schema.primKey;if(c&&i)throw new I.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new I.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let l=c&&a?t.map(Qt(c)):t;return this.core.mutate({trans:o,type:"add",keys:i,values:l,wantResults:s}).then(({numFailures:h,results:d,lastResult:f,failures:w})=>{if(h===0)return s?d:f;throw new lt(`${this.name}.bulkAdd(): ${h} of ${u} operations failed`,w)})})}bulkPut(t,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:c}=this.schema.primKey;if(c&&i)throw new I.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new I.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let l=c&&a?t.map(Qt(c)):t;return this.core.mutate({trans:o,type:"put",keys:i,values:l,wantResults:s}).then(({numFailures:h,results:d,lastResult:f,failures:w})=>{if(h===0)return s?d:f;throw new lt(`${this.name}.bulkPut(): ${h} of ${u} operations failed`,w)})})}bulkDelete(t){const n=t.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:t})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new lt(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}}function wt(e){var t={},n=function(o,a){if(a){for(var c=arguments.length,u=new Array(c-1);--c;)u[c-1]=arguments[c];return t[o].subscribe.apply(null,u),e}if(typeof o=="string")return t[o]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(o,a,c){if(typeof o!="object"){var u;a||(a=zs),c||(c=C);var l={subscribers:[],fire:c,subscribe:function(h){l.subscribers.indexOf(h)===-1&&(l.subscribers.push(h),l.fire=a(l.fire,h))},unsubscribe:function(h){l.subscribers=l.subscribers.filter(function(d){return d!==h}),l.fire=l.subscribers.reduce(a,c)}};return t[o]=n[o]=l,l}B(u=o).forEach(function(h){var d=u[h];if(W(d))s(h,u[h][0],u[h][1]);else{if(d!=="asap")throw new I.InvalidArgument("Invalid event config");var f=s(h,ut,function(){for(var w=arguments.length,m=new Array(w);w--;)m[w]=arguments[w];f.subscribers.forEach(function(g){Fr(function(){g.apply(null,m)})})})}})}}function gt(e,t){return Ye(t).from({prototype:e}),t}function tt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Kn(e,t){e.filter=Te(e.filter,t)}function jn(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Te(r(),t()):t,e.justLimit=n&&!r}function Jt(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new I.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function hi(e,t,n){const r=Jt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function Xt(e,t,n,r){const i=e.replayFilter?Te(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(a,c,u)=>{if(!i||i(c,u,d=>c.stop(d),d=>c.fail(d))){var l=c.primaryKey,h=""+l;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(l)),X(s,h)||(s[h]=!0,t(a,c,u))}};return Promise.all([e.or._iterate(o,n),pi(hi(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return pi(hi(e,r,n),Te(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function pi(e,t,n,r){var i=j(r?(s,o,a)=>n(r(s),o,a):n);return e.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();t&&!t(s,a=>o=a,a=>{s.stop(a),o=C},a=>{s.fail(a),o=C})||i(s.value,s,a=>o=a),o()})})}function H(e,t){try{const n=fi(e),r=fi(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(i,s){const o=i.length,a=s.length,c=o<a?o:a;for(let u=0;u<c;++u)if(i[u]!==s[u])return i[u]<s[u]?-1:1;return o===a?0:o<a?-1:1}(mi(e),mi(t));case"Array":return function(i,s){const o=i.length,a=s.length,c=o<a?o:a;for(let u=0;u<c;++u){const l=H(i[u],s[u]);if(l!==0)return l}return o===a?0:o<a?-1:1}(e,t)}}catch{}return NaN}function fi(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const n=pn(e);return n==="ArrayBuffer"?"binary":n}function mi(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class no{_read(t,n){var r=this._ctx;return r.error?r.table._trans(null,N.bind(null,r.error)):r.table._trans("readonly",t).then(n)}_write(t){var n=this._ctx;return n.error?n.table._trans(null,N.bind(null,n.error)):n.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var n=this._ctx;n.algorithm=Te(n.algorithm,t)}_iterate(t,n){return Xt(this._ctx,t,n,this._ctx.table.core)}clone(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&z(r,t),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(t){var n=this._ctx;return this._read(r=>Xt(n,t,r,n.table.core))}count(t){return this._read(n=>{const r=this._ctx,i=r.table.core;if(tt(r,!0))return i.count({trans:n,query:{index:Jt(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return Xt(r,()=>(++s,!1),n,i).then(()=>s)}).then(t)}sortBy(t,n){const r=t.split(".").reverse(),i=r[0],s=r.length-1;function o(u,l){return l?o(u[r[l]],l-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function c(u,l){var h=o(u,s),d=o(l,s);return h<d?-a:h>d?a:0}return this.toArray(function(u){return u.sort(c)}).then(n)}toArray(t){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&tt(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=Jt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return Xt(r,s=>i.push(s),n,r.table.core).then(()=>i)}},t)}offset(t){var n=this._ctx;return t<=0||(n.offset+=t,tt(n)?jn(n,()=>{var r=t;return(i,s)=>r===0||(r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):jn(n,()=>{var r=t;return()=>--r<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),jn(this._ctx,()=>{var n=t;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(t,n){return Kn(this._ctx,function(r,i,s){return!t(r.value)||(i(s),n)}),this}first(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var n,r;return Kn(this._ctx,function(i){return t(i.value)}),n=this._ctx,r=t,n.isMatch=Te(n.isMatch,r),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})}keys(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(t)}primaryKeys(t){var n=this._ctx;if(n.dir==="next"&&tt(n,!0)&&n.limit>0)return this._read(i=>{var s=Jt(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(n){return n[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return Kn(this._ctx,function(i){var s=i.primaryKey.toString(),o=X(r,s);return r[s]=!0,!o}),this}modify(t){var n=this._ctx;return this._write(r=>{var i;if(typeof t=="function")i=t;else{var s=B(t),o=s.length;i=function(m){for(var g=!1,y=0;y<o;++y){var p=s[y],v=t[p];ue(m,p)!==v&&(ne(m,p,v),g=!0)}return g}}const a=n.table.core,{outbound:c,extractKey:u}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,h=[];let d=0;const f=[],w=(m,g)=>{const{failures:y,numFailures:p}=g;d+=m-p;for(let v of B(y))h.push(y[v])};return this.clone().primaryKeys().then(m=>{const g=y=>{const p=Math.min(l,m.length-y);return a.getMany({trans:r,keys:m.slice(y,y+p),cache:"immutable"}).then(v=>{const b=[],_=[],S=c?[]:null,E=[];for(let L=0;L<p;++L){const T=v[L],R={value:ct(T),primKey:m[y+L]};i.call(R,R.value,R)!==!1&&(R.value==null?E.push(m[y+L]):c||H(u(T),u(R.value))===0?(_.push(R.value),c&&S.push(m[y+L])):(E.push(m[y+L]),b.push(R.value)))}const A=tt(n)&&n.limit===1/0&&(typeof t!="function"||t===Bn)&&{index:n.index,range:n.range};return Promise.resolve(b.length>0&&a.mutate({trans:r,type:"add",values:b}).then(L=>{for(let T in L.failures)E.splice(parseInt(T),1);w(b.length,L)})).then(()=>(_.length>0||A&&typeof t=="object")&&a.mutate({trans:r,type:"put",keys:S,values:_,criteria:A,changeSpec:typeof t!="function"&&t}).then(L=>w(_.length,L))).then(()=>(E.length>0||A&&t===Bn)&&a.mutate({trans:r,type:"delete",keys:E,criteria:A}).then(L=>w(E.length,L))).then(()=>m.length>y+p&&g(y+l))})};return g(0).then(()=>{if(h.length>0)throw new Tt("Error modifying one or more objects",h,d,f);return m.length})})})}delete(){var t=this._ctx,n=t.range;return tt(t)&&(t.isPrimKey&&!eo||n.type===3)?this._write(r=>{const{primaryKey:i}=t.table.core.schema,s=n;return t.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>t.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:c,results:u,numFailures:l})=>{if(l)throw new Tt("Could not delete some values",Object.keys(a).map(h=>a[h]),o-l);return o-l}))}):this.modify(Bn)}}const Bn=(e,t)=>t.value=null;function ro(e,t){return e<t?-1:e===t?0:1}function io(e,t){return e>t?-1:e===t?0:1}function Z(e,t,n){var r=e instanceof wi?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function nt(e){return new e.Collection(e,()=>yi("")).limit(0)}function so(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),a=-1,c=0;c<o;++c){var u=t[c];if(u!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[c],u)<0&&(a=c)}return o<r.length&&s==="next"?e+n.substr(e.length):o<e.length&&s==="prev"?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function Zt(e,t,n,r){var i,s,o,a,c,u,l,h=n.length;if(!n.every(m=>typeof m=="string"))return Z(e,li);function d(m){i=function(y){return y==="next"?p=>p.toUpperCase():p=>p.toLowerCase()}(m),s=function(y){return y==="next"?p=>p.toLowerCase():p=>p.toUpperCase()}(m),o=m==="next"?ro:io;var g=n.map(function(y){return{lower:s(y),upper:i(y)}}).sort(function(y,p){return o(y.lower,p.lower)});a=g.map(function(y){return y.upper}),c=g.map(function(y){return y.lower}),u=m,l=m==="next"?"":r}d("next");var f=new e.Collection(e,()=>Ee(a[0],c[h-1]+r));f._ondirectionchange=function(m){d(m)};var w=0;return f._addAlgorithm(function(m,g,y){var p=m.key;if(typeof p!="string")return!1;var v=s(p);if(t(v,c,w))return!0;for(var b=null,_=w;_<h;++_){var S=so(p,v,a[_],c[_],o,u);S===null&&b===null?w=_+1:(b===null||o(b,S)>0)&&(b=S)}return g(b!==null?function(){m.continue(b+l)}:y),!1}),f}function Ee(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function yi(e){return{type:1,lower:e,upper:e}}class wi{get Collection(){return this._ctx.table.db.Collection}between(t,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(r||i)&&(!r||!i)?nt(this):new this.Collection(this,()=>Ee(t,n,!r,!i))}catch{return Z(this,pe)}}equals(t){return t==null?Z(this,pe):new this.Collection(this,()=>yi(t))}above(t){return t==null?Z(this,pe):new this.Collection(this,()=>Ee(t,void 0,!0))}aboveOrEqual(t){return t==null?Z(this,pe):new this.Collection(this,()=>Ee(t,void 0,!1))}below(t){return t==null?Z(this,pe):new this.Collection(this,()=>Ee(void 0,t,!1,!0))}belowOrEqual(t){return t==null?Z(this,pe):new this.Collection(this,()=>Ee(void 0,t))}startsWith(t){return typeof t!="string"?Z(this,li):this.between(t,t+Ce,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):Zt(this,(n,r)=>n.indexOf(r[0])===0,[t],Ce)}equalsIgnoreCase(t){return Zt(this,(n,r)=>n===r[0],[t],"")}anyOfIgnoreCase(){var t=de.apply(Qe,arguments);return t.length===0?nt(this):Zt(this,(n,r)=>r.indexOf(n)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=de.apply(Qe,arguments);return t.length===0?nt(this):Zt(this,(n,r)=>r.some(i=>n.indexOf(i)===0),t,Ce)}anyOf(){const t=de.apply(Qe,arguments);let n=this._cmp;try{t.sort(n)}catch{return Z(this,pe)}if(t.length===0)return nt(this);const r=new this.Collection(this,()=>Ee(t[0],t[t.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,t.sort(n)};let i=0;return r._addAlgorithm((s,o,a)=>{const c=s.key;for(;n(c,t[i])>0;)if(++i,i===t.length)return o(a),!1;return n(c,t[i])===0||(o(()=>{s.continue(t[i])}),!1)}),r}notEqual(t){return this.inAnyRange([[Dn,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=de.apply(Qe,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Z(this,pe)}const n=t.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Dn,i]],null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,n){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(t.length===0)return nt(this);if(!t.every(p=>p[0]!==void 0&&p[1]!==void 0&&i(p[0],p[1])<=0))return Z(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",I.InvalidArgument);const c=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;let l,h=i;function d(p,v){return h(p[0],v[0])}try{l=t.reduce(function(p,v){let b=0,_=p.length;for(;b<_;++b){const S=p[b];if(r(v[0],S[1])<0&&r(v[1],S[0])>0){S[0]=o(S[0],v[0]),S[1]=a(S[1],v[1]);break}}return b===_&&p.push(v),p},[]),l.sort(d)}catch{return Z(this,pe)}let f=0;const w=u?p=>i(p,l[f][1])>0:p=>i(p,l[f][1])>=0,m=c?p=>s(p,l[f][0])>0:p=>s(p,l[f][0])>=0;let g=w;const y=new this.Collection(this,()=>Ee(l[0][0],l[l.length-1][1],!c,!u));return y._ondirectionchange=p=>{p==="next"?(g=w,h=i):(g=m,h=s),l.sort(d)},y._addAlgorithm((p,v,b)=>{for(var _=p.key;g(_);)if(++f,f===l.length)return v(b),!1;return!!function(S){return!w(S)&&!m(S)}(_)||(this._cmp(_,l[f][1])===0||this._cmp(_,l[f][0])===0||v(()=>{h===i?p.continue(l[f][0]):p.continue(l[f][1])}),!1)}),y}startsWithAnyOf(){const t=de.apply(Qe,arguments);return t.every(n=>typeof n=="string")?t.length===0?nt(this):this.inAnyRange(t.map(n=>[n,n+Ce])):Z(this,"startsWithAnyOf() only works with strings")}}function ae(e){return j(function(t){return vt(t),e(t.target.error),!1})}function vt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const bt="storagemutated",Se="x-storagemutated-1",Le=wt(null,bt);class oo{_lock(){return at(!U.global),++this._reculock,this._reculock!==1||U.global||(U.lockOwnerFor=this),this}_unlock(){if(at(!U.global),--this._reculock==0)for(U.global||(U.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{et(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&U.lockOwnerFor!==this}create(t){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(at(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new I.DatabaseClosed(r);case"MissingAPIError":throw new I.MissingAPI(r.message,r);default:throw new I.OpenFailed(r)}if(!this.active)throw new I.TransactionInactive;return at(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=j(i=>{vt(i),this._reject(t.error)}),t.onabort=j(i=>{vt(i),this.active&&this._reject(new I.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=j(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Le.storagemutated.fire(t.mutatedParts)}),this}_promise(t,n,r){if(t==="readwrite"&&this.mode!=="readwrite")return N(new I.ReadOnly("Transaction is readonly"));if(!this.active)return N(new I.TransactionInactive);if(this._locked())return new k((s,o)=>{this._blockedFuncs.push([()=>{this._promise(t,n,r).then(s,o)},U])});if(r)return be(()=>{var s=new k((o,a)=>{this._lock();const c=n(o,a,this);c&&c.then&&c.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new k((s,o)=>{var a=n(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var n=this._root();const r=k.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=n._waitingFor;return new k((o,a)=>{r.then(c=>n._waitingQueue.push(j(o.bind(null,c))),c=>n._waitingQueue.push(j(a.bind(null,c)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new I.Abort))}table(t){const n=this._memoizedTables||(this._memoizedTables={});if(X(n,t))return n[t];const r=this.schema[t];if(!r)throw new I.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i}}function Nn(e,t,n,r,i,s,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+gi(t)}}function gi(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function vi(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:Mr(n,r=>[r.name,r])}}let _t=e=>{try{return e.only([[]]),_t=()=>[[]],[[]]}catch{return _t=()=>Ce,Ce}};function Fn(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>ue(r,t)}(e):t=>ue(t,e)}function bi(e){return[].slice.call(e)}let ao=0;function Et(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function co(e,t,n){function r(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:l,lowerOpen:h,upperOpen:d}=c;return u===void 0?l===void 0?null:t.upperBound(l,!!d):l===void 0?t.lowerBound(u,!!h):t.bound(u,l,!!h,!!d)}const{schema:i,hasGetAll:s}=function(c,u){const l=bi(c.objectStoreNames);return{schema:{name:c.name,tables:l.map(h=>u.objectStore(h)).map(h=>{const{keyPath:d,autoIncrement:f}=h,w=W(d),m=d==null,g={},y={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:w,keyPath:d,autoIncrement:f,unique:!0,extractKey:Fn(d)},indexes:bi(h.indexNames).map(p=>h.index(p)).map(p=>{const{name:v,unique:b,multiEntry:_,keyPath:S}=p,E={name:v,compound:W(S),keyPath:S,unique:b,multiEntry:_,extractKey:Fn(S)};return g[Et(S)]=E,E}),getIndexByKeyPath:p=>g[Et(p)]};return g[":id"]=y.primaryKey,d!=null&&(g[Et(d)]=y.primaryKey),y})},hasGetAll:l.length>0&&"getAll"in u.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.tables.map(c=>function(u){const l=u.name;return{name:l,schema:u,mutate:function({trans:h,type:d,keys:f,values:w,range:m}){return new Promise((g,y)=>{g=j(g);const p=h.objectStore(l),v=p.keyPath==null,b=d==="put"||d==="add";if(!b&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:_}=f||w||{length:1};if(f&&w&&f.length!==w.length)throw new Error("Given keys array must have same length as given values array.");if(_===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let S;const E=[],A=[];let L=0;const T=M=>{++L,vt(M)};if(d==="deleteRange"){if(m.type===4)return g({numFailures:L,failures:A,results:[],lastResult:void 0});m.type===3?E.push(S=p.clear()):E.push(S=p.delete(r(m)))}else{const[M,F]=b?v?[w,f]:[w,null]:[f,null];if(b)for(let x=0;x<_;++x)E.push(S=F&&F[x]!==void 0?p[d](M[x],F[x]):p[d](M[x])),S.onerror=T;else for(let x=0;x<_;++x)E.push(S=p[d](M[x])),S.onerror=T}const R=M=>{const F=M.target.result;E.forEach((x,Ie)=>x.error!=null&&(A[Ie]=x.error)),g({numFailures:L,failures:A,results:d==="delete"?f:E.map(x=>x.result),lastResult:F})};S.onerror=M=>{T(M),R(M)},S.onsuccess=R})},getMany:({trans:h,keys:d})=>new Promise((f,w)=>{f=j(f);const m=h.objectStore(l),g=d.length,y=new Array(g);let p,v=0,b=0;const _=E=>{const A=E.target;y[A._pos]=A.result,++b===v&&f(y)},S=ae(w);for(let E=0;E<g;++E)d[E]!=null&&(p=m.get(d[E]),p._pos=E,p.onsuccess=_,p.onerror=S,++v);v===0&&f(y)}),get:({trans:h,key:d})=>new Promise((f,w)=>{f=j(f);const m=h.objectStore(l).get(d);m.onsuccess=g=>f(g.target.result),m.onerror=ae(w)}),query:function(h){return d=>new Promise((f,w)=>{f=j(f);const{trans:m,values:g,limit:y,query:p}=d,v=y===1/0?void 0:y,{index:b,range:_}=p,S=m.objectStore(l),E=b.isPrimaryKey?S:S.index(b.name),A=r(_);if(y===0)return f({result:[]});if(h){const L=g?E.getAll(A,v):E.getAllKeys(A,v);L.onsuccess=T=>f({result:T.target.result}),L.onerror=ae(w)}else{let L=0;const T=g||!("openKeyCursor"in E)?E.openCursor(A):E.openKeyCursor(A),R=[];T.onsuccess=M=>{const F=T.result;return F?(R.push(g?F.value:F.primaryKey),++L===y?f({result:R}):void F.continue()):f({result:R})},T.onerror=ae(w)}})}(s),openCursor:function({trans:h,values:d,query:f,reverse:w,unique:m}){return new Promise((g,y)=>{g=j(g);const{index:p,range:v}=f,b=h.objectStore(l),_=p.isPrimaryKey?b:b.index(p.name),S=w?m?"prevunique":"prev":m?"nextunique":"next",E=d||!("openKeyCursor"in _)?_.openCursor(r(v),S):_.openKeyCursor(r(v),S);E.onerror=ae(y),E.onsuccess=j(A=>{const L=E.result;if(!L)return void g(null);L.___id=++ao,L.done=!1;const T=L.continue.bind(L);let R=L.continuePrimaryKey;R&&(R=R.bind(L));const M=L.advance.bind(L),F=()=>{throw new Error("Cursor not stopped")};L.trans=h,L.stop=L.continue=L.continuePrimaryKey=L.advance=()=>{throw new Error("Cursor not started")},L.fail=j(y),L.next=function(){let x=1;return this.start(()=>x--?this.continue():this.stop()).then(()=>this)},L.start=x=>{const Ie=new Promise((Y,qe)=>{Y=j(Y),E.onerror=ae(qe),L.fail=qe,L.stop=Ut=>{L.stop=L.continue=L.continuePrimaryKey=L.advance=F,Y(Ut)}}),it=()=>{if(E.result)try{x()}catch(Y){L.fail(Y)}else L.done=!0,L.start=()=>{throw new Error("Cursor behind last entry")},L.stop()};return E.onsuccess=j(Y=>{E.onsuccess=it,it()}),L.continue=T,L.continuePrimaryKey=R,L.advance=M,it(),Ie},g(L)},y)})},count({query:h,trans:d}){const{index:f,range:w}=h;return new Promise((m,g)=>{const y=d.objectStore(l),p=f.isPrimaryKey?y:y.index(f.name),v=r(w),b=v?p.count(v):p.count();b.onsuccess=j(_=>m(_.target.result)),b.onerror=ae(g)})}}}(c)),a={};return o.forEach(c=>a[c.name]=c),{stack:"dbcore",transaction:e.transaction.bind(e),table(c){if(!a[c])throw new Error(`Table '${c}' not found`);return a[c]},MIN_KEY:-1/0,MAX_KEY:_t(t),schema:i}}function Mn({_novip:e},t){const n=t.db,r=function(i,s,{IDBKeyRange:o,indexedDB:a},c){return{dbcore:function(l,h){return h.reduce((d,{create:f})=>({...d,...f(d)}),l)}(co(s,o,c),i.dbcore)}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(i=>{const s=i.name;e.core.schema.tables.some(o=>o.name===s)&&(i.core=e.core.table(s),e[s]instanceof e.Table&&(e[s].core=i.core))})}function en({_novip:e},t,n,r){n.forEach(i=>{const s=r[i];t.forEach(o=>{const a=dn(o,i);(!a||"value"in a&&a.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?le(o,i,{get(){return this.table(i)},set(c){Br(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,s))})})}function Vn({_novip:e},t){t.forEach(n=>{for(let r in n)n[r]instanceof e.Table&&delete n[r]})}function lo(e,t){return e._cfg.version-t._cfg.version}function uo(e,t,n,r){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),a=U.transless||U;be(()=>{U.trans=s,U.transless=a,t===0?(B(i).forEach(c=>{qn(n,c,i[c].primKey,i[c].indexes)}),Mn(e,n),k.follow(()=>e.on.populate.fire(s)).catch(o)):function({_novip:c},u,l,h){const d=[],f=c._versions;let w=c._dbSchema=$n(c,c.idbdb,h),m=!1;const g=f.filter(p=>p._cfg.version>=u);function y(){return d.length?k.resolve(d.shift()(l.idbtrans)).then(y):k.resolve()}return g.forEach(p=>{d.push(()=>{const v=w,b=p._cfg.dbschema;zn(c,v,h),zn(c,b,h),w=c._dbSchema=b;const _=_i(v,b);_.add.forEach(E=>{qn(h,E[0],E[1].primKey,E[1].indexes)}),_.change.forEach(E=>{if(E.recreate)throw new I.Upgrade("Not yet support for changing primary key");{const A=h.objectStore(E.name);E.add.forEach(L=>Wn(A,L)),E.change.forEach(L=>{A.deleteIndex(L.name),Wn(A,L)}),E.del.forEach(L=>A.deleteIndex(L))}});const S=p._cfg.contentUpgrade;if(S&&p._cfg.version>u){Mn(c,h),l._memoizedTables={},m=!0;let E=Vr(b);_.del.forEach(R=>{E[R]=v[R]}),Vn(c,[c.Transaction.prototype]),en(c,[c.Transaction.prototype],B(E),E),l.schema=E;const A=mn(S);let L;A&&Ze();const T=k.follow(()=>{if(L=S(l),L&&A){var R=he.bind(null,null);L.then(R,R)}});return L&&typeof L.then=="function"?k.resolve(L):T.then(()=>L)}}),d.push(v=>{(!m||!Zs)&&function(b,_){[].slice.call(_.db.objectStoreNames).forEach(S=>b[S]==null&&_.db.deleteObjectStore(S))}(p._cfg.dbschema,v),Vn(c,[c.Transaction.prototype]),en(c,[c.Transaction.prototype],c._storeNames,c._dbSchema),l.schema=c._dbSchema})}),y().then(()=>{var p,v;v=h,B(p=w).forEach(b=>{v.db.objectStoreNames.contains(b)||qn(v,b,p[b].primKey,p[b].indexes)})})}(e,t,s,n).catch(o)})}function _i(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],s=t[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Gt)o.recreate=!0,n.change.push(o);else{const a=i.idxByName,c=s.idxByName;let u;for(u in a)c[u]||o.del.push(u);for(u in c){const l=a[u],h=c[u];l?l.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}function qn(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>Wn(i,s)),i}function Wn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function $n(e,t,n){const r={};return Ct(t.objectStoreNames,0).forEach(i=>{const s=n.objectStore(i);let o=s.keyPath;const a=Nn(gi(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),c=[];for(let l=0;l<s.indexNames.length;++l){const h=s.index(s.indexNames[l]);o=h.keyPath;var u=Nn(h.name,o,!!h.unique,!!h.multiEntry,!1,o&&typeof o!="string",!1);c.push(u)}r[i]=vi(i,a,c)}),r}function zn({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);e._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const c=o.indexNames[a],u=o.index(c).keyPath,l=typeof u=="string"?u:"["+Ct(u).join("+")+"]";if(t[s]){const h=t[s].idxByName[l];h&&(h.name=c,delete t[s].idxByName[l],t[s].idxByName[c]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&K.WorkerGlobalScope&&K instanceof K.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class ho{_parseStoresSpec(t,n){B(t).forEach(r=>{if(t[r]!==null){var i=t[r].split(",").map((o,a)=>{const c=(o=o.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return Nn(c,u||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),W(u),a===0)}),s=i.shift();if(s.multi)throw new I.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new I.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new I.Schema("Index must have a name and cannot be an empty string")}),n[r]=vi(r,s,i)}})}stores(t){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?z(this._cfg.storesSource,t):t;const r=n._versions,i={};let s={};return r.forEach(o=>{z(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,Vn(n,[n._allTables,n,n.Transaction.prototype]),en(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],B(s),s),n._storeNames=B(s),this}upgrade(t){return this._cfg.contentUpgrade=vn(this._cfg.contentUpgrade||C,t),this}}function Hn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ke(Yt,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Gn(e){return e&&typeof e.databases=="function"}function Yn(e){return be(function(){return U.letThrough=!0,e()})}function po(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function fo(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?N(t.dbOpenError):e);oe&&(t.openCanceller._stackHolder=Oe()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new I.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return k.race([r,(typeof navigator>"u"?k.resolve():po()).then(()=>new k((c,u)=>{if(i(),!n)throw new I.MissingAPI;const l=e.name,h=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!h)throw new I.MissingAPI;h.onerror=ae(u),h.onblocked=j(e._fireOnBlocked),h.onupgradeneeded=j(d=>{if(o=h.transaction,t.autoSchema&&!e._options.allowEmptyDB){h.onerror=vt,o.abort(),h.result.close();const w=n.deleteDatabase(l);w.onsuccess=w.onerror=j(()=>{u(new I.NoSuchDatabase(`Database ${l} doesnt exist`))})}else{o.onerror=ae(u);var f=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=f<1,e._novip.idbdb=h.result,uo(e,f/10,o,u)}},u),h.onsuccess=j(()=>{o=null;const d=e._novip.idbdb=h.result,f=Ct(d.objectStoreNames);if(f.length>0)try{const m=d.transaction((w=f).length===1?w[0]:w,"readonly");t.autoSchema?function({_novip:g},y,p){g.verno=y.version/10;const v=g._dbSchema=$n(0,y,p);g._storeNames=Ct(y.objectStoreNames,0),en(g,[g._allTables],B(v),v)}(e,d,m):(zn(e,e._dbSchema,m),function(g,y){const p=_i($n(0,g.idbdb,y),g._dbSchema);return!(p.add.length||p.change.some(v=>v.add.length||v.change.length))}(e,m)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Mn(e,m)}catch{}var w;yt.push(e),d.onversionchange=j(m=>{t.vcFired=!0,e.on("versionchange").fire(m)}),d.onclose=j(m=>{e.on("close").fire(m)}),a&&function({indexedDB:m,IDBKeyRange:g},y){!Gn(m)&&y!==Yt&&Hn(m,g).put({name:y}).catch(C)}(e._deps,l),c()},u)}))]).then(()=>(i(),t.onReadyBeingFired=[],k.resolve(Yn(()=>e.on.ready.fire(e.vip))).then(function c(){if(t.onReadyBeingFired.length>0){let u=t.onReadyBeingFired.reduce(vn,C);return t.onReadyBeingFired=[],k.resolve(Yn(()=>u(e.vip))).then(c)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(c=>{t.dbOpenError=c;try{o&&o.abort()}catch{}return r===t.openCanceller&&e._close(),N(c)}).finally(()=>{t.openComplete=!0,s()})}function Qn(e){var t=s=>e.next(s),n=i(t),r=i(s=>e.throw(s));function i(s){return o=>{var a=s(o),c=a.value;return a.done?c:c&&typeof c.then=="function"?c.then(n,r):W(c)?Promise.all(c).then(n,r):n(c)}}return i(t)()}function mo(e,t,n){var r=arguments.length;if(r<2)throw new I.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,qr(i),n]}function Ei(e,t,n,r,i){return k.resolve().then(()=>{const s=U.transless||U,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(h){return h.name===gn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>Ei(e,t,n,null,i))):N(h)}const c=mn(i);let u;c&&Ze();const l=k.follow(()=>{if(u=i.call(o,o),u)if(c){var h=he.bind(null,null);u.then(h,h)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=Qn(u))},a);return(u&&typeof u.then=="function"?k.resolve(u).then(h=>o.active?h:N(new I.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):l.then(()=>u)).then(h=>(r&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),N(h)))})}function tn(e,t,n){const r=W(e)?e.slice():[e];for(let i=0;i<n;++i)r.push(t);return r}const yo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},s=[];function o(l,h,d){const f=Et(l),w=i[f]=i[f]||[],m=l==null?0:typeof l=="string"?1:l.length,g=h>0,y={...d,isVirtual:g,keyTail:h,keyLength:m,extractKey:Fn(l),unique:!g&&d.unique};return w.push(y),y.isPrimaryKey||s.push(y),m>1&&o(m===2?l[0]:l.slice(0,m-1),h+1,d),w.sort((p,v)=>p.keyTail-v.keyTail),y}const a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const l of r.indexes)o(l.keyPath,0,l);function c(l){const h=l.query.index;return h.isVirtual?{...l,query:{index:h,range:(d=l.query.range,f=h.keyTail,{type:d.type===1?2:d.type,lower:tn(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,f),lowerOpen:!0,upper:tn(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,f),upperOpen:!0})}}:l;var d,f}return{...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:function(l){const h=i[Et(l)];return h&&h[0]}},count:l=>n.count(c(l)),query:l=>n.query(c(l)),openCursor(l){const{keyTail:h,isVirtual:d,keyLength:f}=l.query.index;return d?n.openCursor(c(l)).then(w=>w&&function(m){return Object.create(m,{continue:{value:function(y){y!=null?m.continue(tn(y,l.reverse?e.MAX_KEY:e.MIN_KEY,h)):l.unique?m.continue(m.key.slice(0,f).concat(l.reverse?e.MIN_KEY:e.MAX_KEY,h)):m.continue()}},continuePrimaryKey:{value(y,p){m.continuePrimaryKey(tn(y,e.MAX_KEY,h),p)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const y=m.key;return f===1?y[0]:y.slice(0,f)}},value:{get:()=>m.value}})}(w)):n.openCursor(l)}}}}}};function Jn(e,t,n,r){return n=n||{},r=r||"",B(e).forEach(i=>{if(X(t,i)){var s=e[i],o=t[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const a=pn(s);a!==pn(o)?n[r+i]=t[i]:a==="Object"?Jn(s,o,n,r+i+"."):s!==o&&(n[r+i]=t[i])}else s!==o&&(n[r+i]=t[i])}else n[r+i]=void 0}),B(t).forEach(i=>{X(e,i)||(n[r+i]=t[i])}),n}const wo={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema;return{...n,mutate(s){const o=U.trans,{deleting:a,creating:c,updating:u}=o.table(t).hook;switch(s.type){case"add":if(c.fire===C)break;return o._promise("readwrite",()=>l(s),!0);case"put":if(c.fire===C&&u.fire===C)break;return o._promise("readwrite",()=>l(s),!0);case"delete":if(a.fire===C)break;return o._promise("readwrite",()=>l(s),!0);case"deleteRange":if(a.fire===C)break;return o._promise("readwrite",()=>function(d){return h(d.trans,d.range,1e4)}(s),!0)}return n.mutate(s);function l(d){const f=U.trans,w=d.keys||function(m,g){return g.type==="delete"?g.keys:g.keys||g.values.map(m.extractKey)}(r,d);if(!w)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:w}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(m,g,y){return g.type==="add"?Promise.resolve([]):m.getMany({trans:g.trans,keys:y,cache:"immutable"})}(n,d,w).then(m=>{const g=w.map((y,p)=>{const v=m[p],b={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(b,y,v,f);else if(d.type==="add"||v===void 0){const _=c.fire.call(b,y,d.values[p],f);y==null&&_!=null&&(y=_,d.keys[p]=y,r.outbound||ne(d.values[p],r.keyPath,y))}else{const _=Jn(v,d.values[p]),S=u.fire.call(b,_,y,v,f);if(S){const E=d.values[p];Object.keys(S).forEach(A=>{X(E,A)?E[A]=S[A]:ne(E,A,S[A])})}}return b});return n.mutate(d).then(({failures:y,results:p,numFailures:v,lastResult:b})=>{for(let _=0;_<w.length;++_){const S=p?p[_]:w[_],E=g[_];S==null?E.onerror&&E.onerror(y[_]):E.onsuccess&&E.onsuccess(d.type==="put"&&m[_]?d.values[_]:S)}return{failures:y,results:p,numFailures:v,lastResult:b}}).catch(y=>(g.forEach(p=>p.onerror&&p.onerror(y)),Promise.reject(y)))})}function h(d,f,w){return n.query({trans:d,values:!1,query:{index:r,range:f},limit:w}).then(({result:m})=>l({type:"delete",keys:m,trans:d}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):m.length<w?{failures:[],numFailures:0,lastResult:void 0}:h(d,{...f,lower:m[m.length-1],lowerOpen:!0},w)))}}}}})};function Si(e,t,n){try{if(!t||t.keys.length<e.length)return null;const r=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)H(t.keys[i],e[s])===0&&(r.push(n?ct(t.values[i]):t.values[i]),++s);return r.length===e.length?r:null}catch{return null}}const go={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const i=Si(r.keys,r.trans._cache,r.cache==="clone");return i?k.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?ct(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Xn(e){return!("from"in e)}const fe=function(e,t){if(!this){const n=new fe;return e&&"d"in e&&z(n,e),n}z(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function St(e,t,n){const r=H(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Xn(e))return z(e,{from:t,to:n,d:1});const i=e.l,s=e.r;if(H(n,e.from)<0)return i?St(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Li(e);if(H(t,e.to)>0)return s?St(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Li(e);H(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),H(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&nn(e,i),s&&o&&nn(e,s)}function nn(e,t){Xn(t)||function n(r,{from:i,to:s,l:o,r:a}){St(r,i,s),o&&n(r,o),a&&n(r,a)}(e,t)}function vo(e,t){const n=Zn(t);let r=n.next();if(r.done)return!1;let i=r.value;const s=Zn(e);let o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(H(a.from,i.to)<=0&&H(a.to,i.from)>=0)return!0;H(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Zn(e){let t=Xn(e)?null:{s:0,n:e};return{next(n){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&H(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||H(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Li(e){var t,n;const r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...e},a=e[i];e.from=a.from,e.to=a.to,e[i]=a[i],o[i]=a[s],e[s]=o,o.d=ki(o)}e.d=ki(e)}function ki({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}Ge(fe.prototype,{add(e){return nn(this,e),this},addKey(e){return St(this,e,e),this},addKeys(e){return e.forEach(t=>St(this,t,t)),this},[fn](){return Zn(this)}});const bo={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new fe(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:c}=o,u={...i,mutate:d=>{const f=d.trans,w=f.mutatedParts||(f.mutatedParts={}),m=S=>{const E=`idb://${t}/${r}/${S}`;return w[E]||(w[E]=new fe)},g=m(""),y=m(":dels"),{type:p}=d;let[v,b]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const _=d.trans._cache;return i.mutate(d).then(S=>{if(W(v)){p!=="delete"&&(v=S.results),g.addKeys(v);const E=Si(v,_);E||p==="add"||y.addKeys(v),(E||b)&&function(A,L,T,R){function M(F){const x=A(F.name||"");function Ie(Y){return Y!=null?F.extractKey(Y):null}const it=Y=>F.multiEntry&&W(Y)?Y.forEach(qe=>x.addKey(qe)):x.addKey(Y);(T||R).forEach((Y,qe)=>{const Ut=T&&Ie(T[qe]),mr=R&&Ie(R[qe]);H(Ut,mr)!==0&&(Ut!=null&&it(Ut),mr!=null&&it(mr))})}L.indexes.forEach(M)}(m,s,E,b)}else if(v){const E={from:v.lower,to:v.upper};y.add(E),g.add(E)}else g.add(n),y.add(n),s.indexes.forEach(E=>m(E.name).add(n));return S})}},l=({query:{index:d,range:f}})=>{var w,m;return[d,new fe((w=f.lower)!==null&&w!==void 0?w:e.MIN_KEY,(m=f.upper)!==null&&m!==void 0?m:e.MAX_KEY)]},h={get:d=>[o,new fe(d.key)],getMany:d=>[o,new fe().addKeys(d.keys)],count:l,query:l,openCursor:l};return B(h).forEach(d=>{u[d]=function(f){const{subscr:w}=U;if(w){const m=b=>{const _=`idb://${t}/${r}/${b}`;return w[_]||(w[_]=new fe)},g=m(""),y=m(":dels"),[p,v]=h[d](f);if(m(p.name||"").add(v),!p.isPrimaryKey){if(d!=="count"){const b=d==="query"&&c&&f.values&&i.query({...f,values:!1});return i[d].apply(this,arguments).then(_=>{if(d==="query"){if(c&&f.values)return b.then(({result:E})=>(g.addKeys(E),_));const S=f.values?_.result.map(a):_.result;f.values?g.addKeys(S):y.addKeys(S)}else if(d==="openCursor"){const S=_,E=f.values;return S&&Object.create(S,{key:{get:()=>(y.addKey(S.primaryKey),S.key)},primaryKey:{get(){const A=S.primaryKey;return y.addKey(A),A}},value:{get:()=>(E&&g.addKey(S.primaryKey),S.value)}})}return _})}y.add(n)}}return i[d].apply(this,arguments)}}),u}}}};class Ke{constructor(t,n){this._middlewares={},this.verno=0;const r=Ke.dependencies;this._options=n={addons:Ke.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:C,dbReadyPromise:null,cancelOpen:C,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new k(a=>{s.dbReadyResolve=a}),s.openCanceller=new k((a,c)=>{s.cancelOpen=c}),this._state=s,this.name=t,this.on=wt(this,"populate","blocked","versionchange","close",{ready:[vn,C]}),this.on.ready.subscribe=Nr(this.on.ready.subscribe,a=>(c,u)=>{Ke.vip(()=>{const l=this._state;if(l.openComplete)l.dbOpenError||k.resolve().then(c),u&&a(c);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(c),u&&a(c);else{a(c);const h=this;u||a(function d(){h.on.ready.unsubscribe(c),h.on.ready.unsubscribe(d)})}})}),this.Collection=(o=this,gt(no.prototype,function(a,c){this.db=o;let u=di,l=null;if(c)try{u=c()}catch(w){l=w}const h=a._ctx,d=h.table,f=d.hook.reading.fire;this._ctx={table:d,index:h.index,isPrimKey:!h.index||d.schema.primKey.keyPath&&h.index===d.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:l,or:h.or,valueMapper:f!==ut?f:null}})),this.Table=function(a){return gt(to.prototype,function(c,u,l){this.db=a,this._tx=l,this.name=c,this.schema=u,this.hook=a._allTables[c]?a._allTables[c].hook:wt(null,{creating:[qs,C],reading:[Vs,ut],updating:[$s,C],deleting:[Ws,C]})})}(this),this.Transaction=function(a){return gt(oo.prototype,function(c,u,l,h,d){this.db=a,this.mode=c,this.storeNames=u,this.schema=l,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=wt(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new k((f,w)=>{this._resolve=f,this._reject=w}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var w=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):w&&this.idbtrans&&this.idbtrans.abort(),N(f)})})}(this),this.Version=function(a){return gt(ho.prototype,function(c){this.db=a,this._cfg={version:c,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return gt(wi.prototype,function(c,u,l){this.db=a,this._ctx={table:c,index:u===":id"?null:u,or:l};const h=a._deps.indexedDB;if(!h)throw new I.MissingAPI;this._cmp=this._ascending=h.cmp.bind(h),this._descending=(d,f)=>h.cmp(f,d),this._max=(d,f)=>h.cmp(d,f)>0?d:f,this._min=(d,f)=>h.cmp(d,f)<0?d:f,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=_t(n.IDBKeyRange),this._createTransaction=(a,c,u,l)=>new this.Transaction(a,c,u,this._options.chromeTransactionDurability,l),this._fireOnBlocked=a=>{this.on("blocked").fire(a),yt.filter(c=>c.name===this.name&&c!==this&&!c._state.vcFired).map(c=>c.on("versionchange").fire(a))},this.use(yo),this.use(wo),this.use(bo),this.use(go),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(t){if(isNaN(t)||t<.1)throw new I.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new I.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const n=this._versions;var r=n.filter(i=>i._cfg.version===t)[0];return r||(r=new this.Version(t),n.push(r),n.sort(lo),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(t){return this.idbdb&&(this._state.openComplete||U.letThrough||this._vip)?t():new k((n,r)=>{if(this._state.openComplete)return r(new I.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new I.DatabaseClosed);this.open().catch(C)}this._state.dbReadyPromise.then(n,r)}).then(t)}use({stack:t,create:n,level:r,name:i}){i&&this.unuse({stack:t,name:i});const s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:n,level:r??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:t,name:n,create:r}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>r?i.create!==r:!!n&&i.name!==n)),this}open(){return fo(this)}_close(){const t=this._state,n=yt.indexOf(this);if(n>=0&&yt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new k(r=>{t.dbReadyResolve=r}),t.openCanceller=new k((r,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new I.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,n=this._state;return new k((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=j(()=>{(function({indexedDB:a,IDBKeyRange:c},u){!Gn(a)&&u!==Yt&&Hn(a,c).delete(u).catch(C)})(this._deps,this.name),r()}),o.onerror=ae(i),o.onblocked=this._fireOnBlocked};if(t)throw new I.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return B(this._allTables).map(t=>this._allTables[t])}transaction(){const t=mo.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,n,r){let i=U.trans;i&&i.db===this&&t.indexOf("!")===-1||(i=null);const s=t.indexOf("?")!==-1;let o,a;t=t.replace("!","").replace("?","");try{if(a=n.map(u=>{var l=u instanceof this.Table?u.name:u;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),t=="r"||t===Cn)o=Cn;else{if(t!="rw"&&t!=Tn)throw new I.InvalidArgument("Invalid transaction mode: "+t);o=Tn}if(i){if(i.mode===Cn&&o===Tn){if(!s)throw new I.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1){if(!s)throw new I.SubTransaction("Table "+u+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(l,h)=>{h(u)}):N(u)}const c=Ei.bind(null,this,o,a,i,r);return i?i._promise(o,c,"lock"):U.trans?et(U.transless,()=>this._whenReady(c)):this._whenReady(c)}table(t){if(!X(this._allTables,t))throw new I.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const _o=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Eo{constructor(t){this._subscribe=t}subscribe(t,n,r){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:n,complete:r})}[_o](){return this}}function Ui(e,t){return B(t).forEach(n=>{nn(e[n]||(e[n]=new fe),t[n])}),e}function So(e){let t,n=!1;const r=new Eo(i=>{const s=mn(e);let o=!1,a={},c={};const u={get closed(){return o},unsubscribe:()=>{o=!0,Le.storagemutated.unsubscribe(f)}};i.start&&i.start(u);let l=!1,h=!1;function d(){return B(c).some(m=>a[m]&&vo(a[m],c[m]))}const f=m=>{Ui(a,m),d()&&w()},w=()=>{if(l||o)return;a={};const m={},g=function(y){s&&Ze();const p=()=>be(e,{subscr:y,trans:null}),v=U.trans?et(U.transless,p):p();return s&&v.then(he,he),v}(m);h||(Le(bt,f),h=!0),l=!0,Promise.resolve(g).then(y=>{n=!0,t=y,l=!1,o||(d()?w():(a={},c=m,i.next&&i.next(y)))},y=>{l=!1,n=!1,i.error&&i.error(y),u.unsubscribe()})};return w(),u});return r.hasValue=()=>n,r.getValue=()=>t,r}let er;try{er={indexedDB:K.indexedDB||K.mozIndexedDB||K.webkitIndexedDB||K.msIndexedDB,IDBKeyRange:K.IDBKeyRange||K.webkitIDBKeyRange}}catch{er={indexedDB:null,IDBKeyRange:null}}const je=Ke;function rn(e){let t=me;try{me=!0,Le.storagemutated.fire(e)}finally{me=t}}Ge(je,{...Kt,delete:e=>new je(e,{addons:[]}).delete(),exists:e=>new je(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:n}){return Gn(t)?Promise.resolve(t.databases()).then(r=>r.map(i=>i.name).filter(i=>i!==Yt)):Hn(t,n).toCollection().primaryKeys()}(je.dependencies).then(e)}catch{return N(new I.MissingAPI)}},defineClass:()=>function(e){z(this,e)},ignoreTransaction:e=>U.trans?et(U.transless,e):e(),vip:Yn,async:function(e){return function(){try{var t=Qn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:k.resolve(t)}catch(n){return N(n)}}},spawn:function(e,t,n){try{var r=Qn(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:k.resolve(r)}catch(i){return N(i)}},currentTransaction:{get:()=>U.trans||null},waitFor:function(e,t){const n=k.resolve(typeof e=="function"?je.ignoreTransaction(e):e).timeout(t||6e4);return U.trans?U.trans.waitFor(n):n},Promise:k,debug:{get:()=>oe,set:e=>{$r(e,e==="dexie"?()=>!0:ui)}},derive:Ye,extend:z,props:Ge,override:Nr,Events:wt,on:Le,liveQuery:So,extendObservabilitySet:Ui,getByKeyPath:ue,setByKeyPath:ne,delByKeyPath:function(e,t){typeof t=="string"?ne(e,t,void 0):"length"in t&&[].map.call(t,function(n){ne(e,n,void 0)})},shallowClone:Vr,deepClone:ct,getObjectDiff:Jn,cmp:H,asap:Fr,minKey:Dn,addons:[],connections:yt,errnames:gn,dependencies:er,semVer:ci,version:ci.split(".").map(e=>parseInt(e)).reduce((e,t,n)=>e+t/Math.pow(10,2*n))}),je.maxKey=_t(je.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Le(bt,e=>{if(!me){let t;Gt?(t=document.createEvent("CustomEvent"),t.initCustomEvent(Se,!0,!0,e)):t=new CustomEvent(Se,{detail:e}),me=!0,dispatchEvent(t),me=!1}}),addEventListener(Se,({detail:e})=>{me||rn(e)}));let me=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel(Se);typeof e.unref=="function"&&e.unref(),Le(bt,t=>{me||e.postMessage(t)}),e.onmessage=t=>{t.data&&rn(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Le(bt,t=>{try{me||(typeof localStorage<"u"&&localStorage.setItem(Se,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:Se,changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key===Se){const n=JSON.parse(t.newValue);n&&rn(n.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type===Se&&rn(t.changedParts)})}k.rejectionMapper=function(e,t){if(!e||e instanceof Je||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Yr[e.name])return e;var n=new Yr[e.name](t||e.message,e);return"stack"in e&&le(n,"stack",{get:function(){return this.inner.stack}}),n},$r(oe,ui);var rt=(e=>(e.ReadyForUpload="ReadyForUpload",e.UploadComplete="UploadComplete",e))(rt||{}),Be=(e=>(e.After="after",e.Before="before",e.BeforeAndAfter="beforeAndAfter",e))(Be||{});const tr="sprig.sessionId",Ii="sprig.disableReplayRecording",Lo=30,xi=()=>{ge.setItem(Ii,"disabled")},Ne=()=>!!ge.getItem(Ii),ko=["did not allow mutations","called in an invalid security context"],Uo=e=>{if(!e)return!0;for(const t of ko)if(e.toLowerCase().includes(t))return!1;return!0},Io=(e,t,n)=>{Ne()||t instanceof Error&&(xi(),Uo(t==null?void 0:t.message)&&(window.UserLeap.reportError(e,t,n),Ao()))},xo=async(e,t)=>{var r;let n;try{if((r=window.navigator.storage)!=null&&r.estimate){const{quota:i,usage:s}=await window.navigator.storage.estimate();n={availableSpaceInMB:i&&s?(i-s)/(1024*1024):void 0,quota:i,usage:s}}}catch(i){window.UserLeap.reportError("Error getting storage estimate",i)}Io(e,t,n)},G=(()=>{const e=ge.getItem(tr);return e?(ge.removeItem(tr),e):We()})();window.addEventListener("beforeunload",()=>{ge.setItem(tr,G)});const Ao=async()=>{try{await Promise.allSettled([D.events.clear(),D.chunkUploads.clear(),D.pendingCaptures.clear()])}catch{}},nr=(e,t,n=()=>!0)=>D.table(t).where("timestamp").below(e).and(n).delete(),Oo=()=>{D.events.where("sessionId").equals(G).delete(),D.pendingCaptures.where("sessionId").equals(G).delete()},Po=e=>{const t=e.map(n=>({...n,sessionId:n.sessionId??G}));return D.events.bulkAdd(t)},Ro=(e,t)=>D.events.where("[sessionId+timestamp]").between([G,e],[G,t]).toArray(),Do=(e,t,n)=>{const r=new Date,i=r.setMinutes(r.getMinutes()+(n??Lo));return D.events.where("[sessionId+timestamp]").between([G,e],[G,t]).modify({expiredAt:i})},Co=e=>D.chunkUploads.add({...e,sessionId:e.sessionId??G}),To=(e,t)=>D.chunkUploads.update(e,{data:null,etag:t,status:rt.UploadComplete}),Ko=({status:e,uploadId:t})=>t?D.chunkUploads.where({uploadId:t,status:e}).toArray():D.chunkUploads.where({sessionId:G,status:e}).toArray(),jo=e=>D.chunkUploads.where({uploadId:e,status:rt.UploadComplete}).toArray(),Bo=e=>D.chunkUploads.where({uploadId:e,status:rt.UploadComplete}).delete(),No=e=>D.pendingCaptures.add({...e,sessionId:e.sessionId??G,canUpload:!1}),Fo=()=>D.pendingCaptures.where("sessionId").equals(G).and(e=>e.targetTimestamp<Date.now()).toArray(),Mo=()=>D.pendingCaptures.where("sessionId").equals(G).toArray(),Vo=e=>D.pendingCaptures.where("sessionId").equals(G).and(t=>t.captureParams.responseGroupId===e).modify({canUpload:!0}),qo=async e=>{var t;if((t=window.navigator.storage)!=null&&t.estimate){const{quota:n,usage:r}=await window.navigator.storage.estimate();if(n&&r&&(n-r)/1073741824<e)return!1}return!0};class Wo extends Ke{constructor(){super("replayStorage",{autoOpen:!1});V(this,"events");V(this,"chunkUploads");V(this,"pendingCaptures")}}const D=new Wo;D.version(1).stores({events:"uuid, timestamp, [sessionId+timestamp]",chunkUploads:"uuid, timestamp, [sessionId+status], [uploadId+status], [sessionId+status+uploadId]",pendingCaptures:"uuid, timestamp, [sessionId+targetTimestamp]"}),D.open().catch(()=>{xi()});const $o=async(e,t,n)=>new Promise((r,i)=>{const s=e.createElement("script");s.src=t,s.onload=r,s.onerror=i,n&&(s.nonce=n),e.head.appendChild(s)});let Ai=1,Oi=5e3,rr=6e4;const zo=5,Pi=1e3,Ri=30,sn=Ri+zo,ir="sprig.pendingCount";let Di=0,Ci=Date.now(),sr=!1;var or=(e=>(e.Left="left_click",e.Right="right_click",e))(or||{});const Ho=async(e,t,n,r=2,i)=>{try{if(Ne()||!t||(i!=null&&i.minAvailableGb&&(Ai=i.minAvailableGb),!await qo(Ai)))return;i!=null&&i.minDuration&&(Oi=i.minDuration),i!=null&&i.batchDuration&&(rr=i.batchDuration),As(r),ea(),Qo(t+sn,30*60,t+sn),Jo(),window.rrwebRecord||await $o(e,"https://cdn.sprig.com/dependencies/record-2.0.0-alpha.6.min.js",n);const s=window.rrwebRecord;if(!s)return;let o=!0;s({checkoutEveryNms:Ri*1e3,sampling:{input:"last",scroll:250,media:800},emit:(a,c)=>{if(Ne())return;Ci=Date.now();const u=o||!!c;o=!1,Go({uuid:We(),event:JSON.stringify(a),isValidStart:u,timestamp:Date.now()})},...i}),sr=!0,Di||(Di=window.setInterval(()=>{Date.now()-Ci>Pi&&ke("Sprig_Noop",{})},Pi))}catch(s){return re("Error initializing replay",s)}};let ar=!1,cr=[];const Go=e=>{cr.push(e),ar||Yo()},Yo=()=>{ar=!0,setTimeout(async()=>{if(Ne())return;const e=cr;cr=[],ar=!1;try{await Po(e)}catch(t){re("Error storing replay events",t)}},500)},Qo=(e=6*60,t=30*60,n=4*60)=>{const r=setInterval(()=>{const i=Date.now();Ne()||D.transaction("rw!",D.events,D.chunkUploads,D.pendingCaptures,()=>{nr(i-e*1e3,"events",s=>s.expiredAt===void 0||s.expiredAt<i-e*1e3),nr(i-t*1e3,"chunkUploads"),nr(i-n*1e3,"pendingCaptures",s=>s.canUpload===void 0||s.canUpload===!1)}).catch(s=>{clearInterval(r),re("Error deleting table rows",s)})},3e4)},Jo=(e=5)=>{setInterval(sa,e*1e3)},Xo=async(e,t,n,r,i)=>{try{const s=Math.min(e+i,n),o=await Ro(e,s);if(!(o!=null&&o.length))return[r,[]];if(!r){let a=-1;return o==null||o.forEach((c,u)=>{if(!c.isValidStart)return;const l=c.timestamp<=t;(a<0||l)&&(a=u)}),a<0?[]:[!0,o==null?void 0:o.slice(a)]}return[r,o]}catch(s){re("Error getting events batch",s)}},Zo=(e,t,n)=>{const r=e.length,i=t*1024*1024,s=Math.ceil(r/n),o=Math.max(i,s),a=[];let c=0;for(;c<r;)a.push(e.slice(c,c+o)),c+=o;return a},Ti=e=>Promise.all(e.map(async t=>{const n=await Ps(t);return await To(t.uuid,n),t.uploadId})),Ki=async e=>{const t=await jo(e);if(!(t!=null&&t.length))return;const n=t.reduce((s,o)=>(s.find(a=>a.chunkIndex===o.chunkIndex)||s.push(o),s),[]);n.sort((s,o)=>s.chunkIndex-o.chunkIndex);const r=n.map(s=>({ETag:s.etag,PartNumber:s.chunkIndex})).filter(s=>s.ETag!==null),i=n[0];await jr({apiUrl:i.apiUrl,surveyId:i.surveyId,uploadId:e,responseGroupUuid:i.responseGroupId,etags:r,headers:i.completeUploadHeaders,replayDuration:i.replayDuration}),await Bo(e)},ea=async()=>{try{let e=[];if(await D.transaction("rw",D.chunkUploads,async()=>{e=await Ko({status:rt.ReadyForUpload}).catch(n=>{re("chunkUploads transaction error",n)})}),!(e!=null&&e.length))return;const t=await Ti(e);t!=null&&t.length&&await Promise.all(t.map(async n=>{n&&await Ki(n)}))}catch(e){re("Error getting chunk upload uuids",e)}},ta=async(e,t)=>{await Ti(t),await Promise.all(e.map(n=>Ki(n)))},na=e=>{let t=0;e.forEach(i=>{t+=i.length});const n=new Uint8Array(t);let r=0;return e.forEach(i=>{n.set(i,r),r+=i.length}),n},ji=async(e,t,n)=>{const r=new TextEncoder;let i=null,s=null,o=null,a=!1,c=!1,[u,l]=[0,0];const h=e-sn*1e3,d=[];let f=[];for(let m=h;m<t;m+=rr){if([c,f]=await Xo(m,e,t,c,rr),!(f!=null&&f.length))continue;u===0&&(u=f[0].timestamp),l=f[f.length-1].timestamp;const g=`${a?",":"["}${f.map(p=>p.event).join(",")}`,y=r.encode(g);n?(s===null&&(o=new window.CompressionStream("gzip"),s=o.writable.getWriter()),s.write(y)):d.push(y),a=!0}if(l-u<Oi)return null;const w=r.encode("]");return s&&o?(s.write(w),s.close(),i=new Uint8Array(await new Response(o.readable).arrayBuffer())):(d.push(w),i=na(d)),i},ra=async(e,t)=>{const n=window.CompressionStream!==void 0;let r=null;const i=t??Date.now(),s=i-e;try{r=await ji(s,i,n)}catch(o){if(o instanceof Error&&window.UserLeap.reportError("Error compressing replay",o),n)try{r=await ji(s,i,!1)}catch(a){re("fileData fallback failed",a)}}return r},Bi=async e=>{const{surveyId:t,responseGroupId:n,visitorId:r,apiUrl:i,completeUploadHeaders:s,replayParams:o,triggerTimestamp:a}=e,c=await ra(o.replayDurationSeconds*1e3,a);if(!(c!=null&&c.length))return;const u=Zo(c,o.minimumChunkSizeMb,o.signedUrls.length),l=await Promise.all(u.map(async(h,d)=>{const f=We(),w={apiUrl:i,chunkIndex:d+1,completeUploadHeaders:s,etag:null,responseGroupId:n,status:rt.ReadyForUpload,surveyId:t,timestamp:a,totalChunks:u.length,data:h,uploadId:o.uploadId,uploadUrl:o.signedUrls[d].url,uuid:f,visitorId:r};return await Co(w),w}));await ta([o.uploadId],l)},Ni=async(e,t)=>{try{if(Ne())return;const{isStandalone:n,replayParams:r,triggerTimestamp:i,responseGroupId:s}=e,o=async()=>{setTimeout(()=>P.removeListener(O.QuestionAnswered,o),0),r.replayDurationType===Be.Before?await Bi(e):await Vo(s)};if(r.replayDurationType===Be.After||r.replayDurationType===Be.BeforeAndAfter){n||P.on(O.QuestionAnswered,o),await ia(e);return}if(n||t)await Bi(e);else{const a=sn+r.replayDurationSeconds;await Do(i-a*1e3,i,r.expirationTimeLimitMinutes),P.on(O.QuestionAnswered,o)}}catch(n){re("Error scheduling or capturing replay",n)}},Fi=()=>{if(!Ne())try{Oo()}catch(e){re("Error clearing session event data",e)}};let ye=ge.getItem(ir);const ia=async e=>{const{surveyId:t}=e,n=await Mo(),r=n==null?void 0:n.filter(o=>o.captureParams.surveyId===t);if(r!=null&&r.length)return;const i={...e,replayParams:{...e.replayParams}};e.replayParams.replayDurationType===Be.BeforeAndAfter&&(i.replayParams.replayDurationSeconds*=2),i.replayParams.replayDurationType=Be.Before;const s=e.triggerTimestamp+e.replayParams.replayDurationSeconds*1e3;return i.triggerTimestamp=s,ye=ye?(parseInt(ye)+1).toString():"1",ge.setItem(ir,ye),No({uuid:We(),targetTimestamp:s,timestamp:Date.now(),captureParams:i})},sa=async()=>{try{if(ye&&parseInt(ye)>0){const e=await Fo();e.length&&await Promise.all(e.map(async t=>{await D.pendingCaptures.delete(t.uuid),await Ni(t.captureParams,t.canUpload)})),ye=(parseInt(ye)-e.length).toString(),ge.setItem(ir,ye)}}catch(e){re("Error initiating pending captures",e)}},ke=(e,t)=>{var n,r;if(sr)try{(r=(n=window.rrwebRecord)==null?void 0:n.addCustomEvent)==null||r.call(n,e,t)}catch(i){re("Error recording custom event",i)}},Mi=e=>{ke("Sprig_PageView",e)},oa=e=>{ke("Sprig_TrackEvent",e)},aa=e=>{ke("Sprig_ShowSurvey",e)},ca=e=>{ke("Sprig_Click",e)},la=()=>{ke("Sprig_Refresh",{})},ua=()=>{ke("Sprig_BackForward",{})},da=e=>{ke("Sprig_Keystroke",e)},re=(e,t)=>(sr=!1,xo(e,t)),lr={capture:!0},ha=["a","button","input","option","li","link"],pa=["Escape","Enter","Backspace","F5","Tab"],fa=["label","type","role","title","placeholder","errormessage","valuetext","href"],Vi="aria-",ma=e=>{const t=e.getAttribute("type");return t?`${t} ${e.tagName.toLowerCase()}`:e.tagName.toLowerCase()},qi=e=>{if(e.tagName.toLowerCase()==="html")return{element:"html"};const t=e.textContent,n=t?{text:t}:{};n.element=ma(e);for(const r of e.attributes){let i=r.name;const s=r.value;i.startsWith(Vi)&&(i=i.substring(Vi.length)),fa.includes(i)&&(n[i]=s)}return n},ya=e=>{if(!e)return{};const n={...qi(e)},r=e.parentElement;if(r&&ha.includes(r.tagName.toLowerCase())){const i=qi(r);Object.assign(n,i)}return n},Wi=(e,t)=>{ca({x:t.x,y:t.y,type:e,elementAttributes:ya(t.target)})},wa=e=>t=>Wi(e,t),ga=e=>{pa.includes(e.key)&&da({key:e.key})},va=()=>{window.performance.getEntriesByType("navigation").map(t=>t.type).includes("reload")&&la()},ba=()=>{window.performance.getEntriesByType("navigation").map(t=>t.type).includes("back_forward")&&ua()},_a=()=>{window.addEventListener("click",wa(or.Left),lr),window.addEventListener("mousedown",e=>{e.button===2&&Wi(or.Right,e)},lr),window.addEventListener("keydown",ga,lr),va(),ba()},Ea=["popState","pushState","replaceState"],Sa={test:"test"},Lt="!email",La=["ios","android"],Fe="environments",ur="pageUrl",Me="visitors",$i="ul-view-sdk-script",zi=Object.freeze({contains:(e,t)=>t.includes(e),notContains:(e,t)=>!t.includes(e),exactly:(e,t)=>t===e,notExactly:(e,t)=>t!==e,startsWith:(e,t)=>t.startsWith(e),endsWith:(e,t)=>t.endsWith(e),regex:(e,t)=>new RegExp(e).test(t),legacy:(e,t)=>new RegExp(e,"i").test(t)});function dr(e,t){const{matchType:n,pattern:r}=e,i=n?zi[n]:zi.legacy;let s=!1;try{s=i(r,t)}catch(o){const a=`[Sprig] (ERR-445) Failed to check url match with pattern ${r}`;o instanceof Error&&(console.warn(a,o),o.stack=JSON.stringify(e),window.UserLeap.reportError(a,o))}return s}function ka(e,t){const{pageUrlEvents:n,interactiveEvents:r,dismissOnPageChange:i}=window.UserLeap._config;if(!i)return!0;const s=[];n&&n.length&&s.push(...n),r&&r.length&&s.push(...r);const o=e&&s.find(a=>a.id===e);return o?dr(o,window.location.href):t===window.location.href}function kt(e){const{pageUrlEvents:t,interactiveEvents:n,dismissOnPageChange:r,platform:i}=window.UserLeap._config;if(i&&i!==xt.Web)return;const s=Ve("trackStartUrl"),o=s?String(s):null;t&&Qi(window.location.href),n&&(Gi(),Ua()),r&&o&&o!==window.location.href&&e&&Ea.includes(e.type)&&window.UserLeap("dismissActiveSurvey",Ae.PageChange)}const Hi={capture:!0},Ua=()=>{const t=window.UserLeap._config.interactiveEvents.filter(r=>dr(r,window.location.href)).map(r=>{const{name:i,properties:s}=r,{selector:o,innerText:a}=s;return o?c=>{if(Ar(c.target))try{c.target.closest(o)&&window.UserLeap("track",i)}catch{}return!1}:c=>(Ar(c.target)&&c.target.innerText===a&&window.UserLeap("track",i),!1)}),n=r=>t.forEach(i=>i(r));window.UserLeap._config.interactiveEventsHandler=n,window.addEventListener("click",n,Hi)},Gi=()=>{window.UserLeap._config.interactiveEventsHandler&&window.removeEventListener("click",window.UserLeap._config.interactiveEventsHandler,Hi),delete window.UserLeap._config.interactiveEventsHandler};function Ia(){["hashchange","popstate"].forEach(e=>window.addEventListener(e,kt,!0))}function xa(){["hashchange","popstate"].forEach(e=>window.removeEventListener(e,kt,!0)),window.UserLeap._config.interactiveEvents&&Gi()}function we(e,t,n){const r=[window.UserLeap._API_URL,"sdk",e];return t&&t.forEach(i=>{r.push(i),i===Fe?r.push(window.UserLeap.envId):i===Me&&r.push(hr())}),n&&r.push(n),r.join("/")}function Aa(e,t){let n=we("1",[Fe],"questions?");return e!=null&&(n+=`&vid=${e}`),t&&(t.surveyId&&(n+=`&surveyid=${t.surveyId}`),t.surveyTemplateId&&(n+=`&surveytemplateid=${t.surveyTemplateId}`),t.previewLanguage&&(n+=`&previewLanguage=${encodeURIComponent(t.previewLanguage)}`)),n}function Ve(e){const t=J.getItem(Q.Credentials);if(t)try{const r=JSON.parse(t)[window.UserLeap.envId];return r&&r[e]||null}catch(n){n instanceof Error&&(n.stack=t,window.UserLeap.reportError("Failed to parse local storage credentials",n)),console.warn("[Sprig] (ERR-427) Failed to lookup saved ids",n)}return null}function ee(e,t){const n=J.getItem(Q.Credentials);let r={};if(n)try{r=JSON.parse(n)}catch(s){s instanceof Error&&(s.stack=n,window.UserLeap.reportError("Failed to parse local storage credentials",s)),console.warn("[Sprig] (ERR-427) Failed to lookup saved ids",s)}let i=r[window.UserLeap.envId];i?i[e]=t:i={[e]:t},r[window.UserLeap.envId]=i;try{J.setItem(Q.Credentials,JSON.stringify(r))}catch(s){s instanceof Error&&console.warn(`[Sprig] (ERR-426) Unable to write to Local Storage:: ${s.message}`)}}function Yi(){window.previewMode||(window.UserLeap.visitorId=We(),ee("vid",window.UserLeap.visitorId),P.emit(O.VisitorIDUpdated,{visitorId:window.UserLeap.visitorId}))}function hr(){return window.previewMode?"0":window.UserLeap.visitorId||""}function Qi(e,t,n){if(e.endsWith("mock_snippet.html"))return;const r=window.UserLeap._config.pageUrlEvents;let i=!1;if(r&&r.length)for(let l=0;l<r.length&&(i=dr(r[l],e),!i);l++);if(!i)return;window.UserLeap.debugMode&&console.info("[DEBUG] Sprig trackPageView",e);const s=10,o=1;let a=[];const c={viewedAt:Date.now(),location:e},u=J.getItem(Q.PageViews);try{if(a=u?JSON.parse(u):[],Array.isArray(a)||(a=[]),a.length>0){const l=a[a.length-1],h=(Date.now()-l.viewedAt)/1e3;l.location!=e&&h>o&&Mi({url:e,referrer:document.referrer,description:document.title}),(l.location!=e&&h>o||h>s)&&(window.UserLeap._queue.push(["track",ur,t,{url:e},n]),a.push(c))}else window.UserLeap._queue.push(["track",ur,t,{url:e},n]),a.push(c),Mi({url:e});a.length>5&&a.splice(0,a.length-5),J.setItem(Q.PageViews,JSON.stringify(a))}catch(l){l instanceof Error&&window.UserLeap.reportError("trackPageView",l,{pageViewsStorage:u}),console.warn("[Sprig] (ERR-425) Failed to update page views in local storage")}}function Oa(){const e="Backbone"in window&&window.Backbone&&window.Backbone.history?window.Backbone.history:window.history;"pushState"in e&&(e.pushState=(t=>function(...r){const i=t.apply(this,r),s=new Event("pushState");return window.dispatchEvent(s),kt(s),i})(e.pushState)),"replaceState"in e&&(e.replaceState=(t=>function(...r){const i=t.apply(this,r),s=new Event("replaceState");return window.dispatchEvent(s),kt(s),i})(e.replaceState)),Ia()}async function pr(e,t){const n=hr();e&&!t&&(window.UserLeap._config.mode=Sa.test);const r=await Ue(Aa(n,{...e,previewLanguage:window.UserLeap._config.previewLanguage}),{},0,!0);return r.ok?(r.json.delay&&await Pt(r.json.delay),Ji(r.json)):(r.reportError&&r.error&&(console.warn("[Sprig] (ERR-414) Failed to request questions from the server",r.error),window.UserLeap.reportError("getQuestions",r.error)),{success:!1,surveyState:te.NoSurvey})}const Ji=async e=>{var M,F;const{context:t,forceBrandedLogo:n,endCard:r,locale:i,productConfig:s,questions:o,responseGroupUid:a,surveyId:c,uuid:u,vid:l,sessionReplay:h}=e,d=ze(window.UserLeap),f=fr(d),w=Pa(d);if(h)if(f){const x={mediaRecordingUid:We(),mediaType:Ur.Screen,questionId:1,responseGroupUid:a,surveyId:c,updatedAt:new Date().toISOString(),visitorId:window.UserLeap.visitorId,isReplay:!0};P.emit(O.ReplayCapture,{responseGroupUid:a,hasQuestions:!!(o!=null&&o.length),surveyId:c,uploadId:h.uploadId,replayType:h.replayDurationType??Be.Before,seconds:h.replayDurationSeconds,generateVideoUploadUrlPayload:x})}else Ni({responseGroupId:a,surveyId:c,visitorId:l,replayParams:h,completeUploadHeaders:d,apiUrl:window.UserLeap._API_URL,triggerTimestamp:Date.now(),isStandalone:o.length===0});if(l==null||!o||!o.length)return{success:!1,message:"[Sprig] no survey found",surveyState:te.NoSurvey};if(window.UserLeap.container){const x="[Sprig] (ERR-409) Found an existing Survey container, aborting rendering of this survey";return console.warn(x),{success:!1,message:x,surveyState:te.NoSurvey}}if(l!==window.UserLeap.visitorId&&u!==window.UserLeap.visitorId&&!window.previewMode){const x="Attempted to display survey to a different visitor";return window.UserLeap.reportError("DisplaySurvey",new Error(x)),{success:!1,message:x,surveyState:te.NoSurvey}}aa({id:c}),ms.disable(),P.emit(O.SurveyWillPresent,{name:O.SurveyWillPresent,[It.SurveyId]:c});let m,g=document.createElement("div"),y,p,v;const b=x=>{const{[gr.ViewVersion]:Ie}=x;Ie!==d["x-ul-sdk-version"]&&Er(),P.removeListener(on.VerifyViewVersion,b)};P.on(on.VerifyViewVersion,b),bs(d)?(m="ul-direct-embeded-frame",y=document.head,p=window,v=!1,f&&(_r(),g.id=m,window.UserLeap.container.appendChild(g),Sr(),P.emit(O.SurveyLifeCycle,{state:"presented"}),P.emit(O.SurveyPresented,{name:O.SurveyPresented,[It.SurveyId]:c}))):{frameId:m,contentWinDocHead:y,contentWindow:p,hasOverlay:v,iframe:g}=os(s,w,c),window.UserLeap.frameId=m,window.UserLeap.useMobileStyling=w;const _=x=>{P.on(O.CloseSurveyOnOverlayClick,x)},S=Object.assign({frame:g,envId:window.UserLeap.envId,surveyId:c,userId:u,visitorAttributes:{externalUserId:window.UserLeap.userId,email:window.UserLeap.email},cards:o,context:t,locale:i,fontFamily:window.UserLeap.fontFamily,fontFamilyURL:window.UserLeap.fontFamilyURL,apiURL:window.UserLeap._API_URL,responseGroupUid:a,headers:d,endCard:r,useMobileStyling:w,mobileSDKVersion:window.UserLeap.mobileSDKVersion,configureExitOnOverlayClick:_,eventEmitFn:P.emit.bind(P),ulEvents:wr,viewDocument:p==null?void 0:p.document,viewWindow:p,tabTitle:document.title,startingQuestionIdx:(M=window.UserLeap.config)==null?void 0:M.startingQuestionIdx,styleNonce:window.UserLeap.styleNonce,previewKey:J.getItem(Q.Preview),forceBrandedLogo:n},window.UserLeap._config);(F=window.UserLeap.config)!=null&&F.startingQuestionIdx&&(window.UserLeap.config={...window.UserLeap.config,startingQuestionIdx:null}),window.UserLeap.customStyles&&(S.customStyles=window.UserLeap.customStyles),p&&(p.__cfg=S);function E(){const x=document.createElement("script");return window.UserLeap.nonce&&x.setAttribute("nonce",window.UserLeap.nonce),x.id=$i,x}const A=window.UserLeap.viewSDKURL?window.UserLeap.viewSDKURL:S.path,L=document.getElementById($i);L&&L.remove();const T=E(),R=()=>{window.UserLeap.container&&Object.assign(window.UserLeap.container.style,{display:"flex"})};if(S.installationMethod===$e.Npm||S.installationMethod===$e.NpmBundled){const{default:x}=await import("../view/view.tsx");x.configure(S),v&&window.UserLeap.container&&R()}else A&&(T.src=A,v&&T.addEventListener("load",()=>{window.UserLeap.container&&R()}),p==null||p.addEventListener("error",x=>{x.target instanceof HTMLScriptElement&&x.target.src===A&&window.UserLeap.reportError("loadFrameScript",new Error("Frame script failed to load"))},{capture:!0,once:!0}));return y==null||y.appendChild(T),{success:!0,surveyState:te.Ready,surveyId:c,responseGroupUid:a}};function Pa(e){if(window.UserLeap.useMobileStyling!==void 0)return window.UserLeap.useMobileStyling;const t=window.UserLeap.windowDimensions&&window.UserLeap.windowDimensions.width||document.body.clientWidth;return fr(e)||t>10&&t<fs}function fr(e){return La.includes(e[se.Platform])}function Ra(e){let t=e.length;for(;t;){const n=Math.floor(Math.random()*t);t-=1;const r=e[t];e[t]=e[n],e[n]=r}}function Da(e){if(!e)return;window.UserLeap._config=e,e.mute&&window.UserLeap._queue.pause();const{interactiveEvents:t,pageUrlEvents:n,dismissOnPageChange:r}=e;t&&Ra(t),(t||n||r)&&(Oa(),kt())}async function Ue(e,t,n=0,r=!1){var s,o;t.headers=Object.assign(ze(window.UserLeap),t.headers);const i=await He(e,t,n,r);if(i.ok){const a=(s=i.headers)==null?void 0:s.get("Authorization"),c=a?a.split(" "):void 0,u=c&&c.length===2?c[1]:void 0,l=(o=i.headers)==null?void 0:o.get(se.VisitorID);u&&l&&(l!==window.UserLeap.visitorId||window.UserLeap.token!==u)&&(ee("token",u),ee("vid",l),P.emit(O.VisitorIDUpdated,{visitorId:l}),window.UserLeap.token=u,window.UserLeap.visitorId=l)}return i.json&&i.json.logMessage&&console.warn(`[Sprig] ${i.json.logMessage}`),i}async function Ca(e,t){var r,i;let n=!0;return t&&((r=e==null?void 0:e.json)!=null&&r.surveyId)&&(window.UserLeap.delayingSurvey=!0,n=await t(e.json.surveyId),window.UserLeap.delayingSurvey=!1,!n)?!1:((i=e==null?void 0:e.json)!=null&&i.delay&&(window.UserLeap.delayingSurvey=!0,await Pt(e.json.delay),window.UserLeap.delayingSurvey=!1),n)}const Ta=function(e){if(!window.UserLeap)return;const t=async(r={})=>{var m,g,y,p;const{userId:i,anonymousId:s,metadata:o={},properties:a,showSurveyCallback:c}=r;let{eventName:u}=r;if(window.UserLeap.debugMode&&u!==ur&&console.info("[DEBUG] Sprig track",r),e.mode==="test")return;const l=J.getItem(Q.Preview)??void 0;if(e.requireUserIdForTracking&&!window.UserLeap.userId&&!i){const v="[Sprig] - Skipping tracking without userId";return console.warn(v),{success:!1,message:v,surveyState:te.NoSurvey}}if(!u||u.trim().length===0){u=u?String(u):"";const v="[Sprig] - Invalid event name "+u;return console.warn(v),{success:!1,message:v,surveyState:te.NoSurvey}}const h=window.location.href;if(o.url||(o.url=h),ee("trackStartUrl",h),(g=(m=window.UserLeap)==null?void 0:m._config)!=null&&g.optimizelyEnabled){const v=ze(window.UserLeap);fr(v)||At.getAndSetWebOptimizelyExperiments(),o.optimizelyExperiments=Object.assign({},At.getAllOptimizelyExperiments())}(p=(y=window.UserLeap)==null?void 0:y._config)!=null&&p.launchDarklyEnabled&&(o.launchDarklyFlags=cn.getAllLaunchDarklyVariations()),i&&(window.UserLeap.userId=i),s&&(window.UserLeap.partnerAnonymousId=s),a&&(o.eventProperties=a),oa({name:u,url:o.url});const d=window.UserLeap.delayingSurvey?await Ue(we("1",[Me],"events/batch"),{body:JSON.stringify({events:[{event:u,metadata:o}],previewKey:l}),method:"POST"},0,!0):await Ue(we("1",[Me],"events"),{body:JSON.stringify({event:u,metadata:o,previewKey:l}),method:"POST"},0,!0);if(!d.ok){const v="[Sprig] (ERR-421) Failed to track event";return d.reportError&&(console.warn(v,d.error),d.error&&window.UserLeap.reportError("track",d.error)),{success:!1,message:v,error:d.error,surveyState:te.NoSurvey}}i&&ee("uid",i),s&&ee("aid",s);const f=d.json;return f.invalidPreviewKey&&J.removeItem(Q.Preview),await Ca(d,c)?ka(f.eventId,h)?Ji(f):{success:!1,message:"Study should not be displayed after page navigation",surveyState:te.NoSurvey}:{success:!1,message:"[Sprig] Callback returned false, aborting rendering of survey",surveyState:te.NoSurvey}},n={async displaySurvey(r){return console.warn("[Sprig] displaySurvey should only be used to debug your studies; not intended for production usage."),window.UserLeap("dismissActiveSurvey",Ae.Override),pr({surveyId:r},!0)},_previewSurvey(r){window.UserLeap("dismissActiveSurvey",Ae.Override),pr({surveyTemplateId:r},!1)},_reviewSurvey(r){window.UserLeap("dismissActiveSurvey",Ae.Override),pr({surveyId:r},!1)},previewSurvey(r){n._previewSurvey(r)},reviewSurvey(r){n._reviewSurvey(r)},mute(){window.UserLeap._queue.pause()},unmute(){window.UserLeap._queue.unpause()},setVisitorToken(){console.warn("[Sprig] setVisitorToken is deprecated.")},dismissActiveSurvey(r=Ae.API){P.emit(O.SurveyWillClose,{name:O.SurveyWillClose,initiator:r})},async setAttribute(r,i){if(!r||!i&&i!==0){const s="[Sprig] - Disregarding empty attribute / value provided";return console.warn(s),{success:!1,message:s}}return this.setAttributes({[r]:i})},async setAttributes(r){if(r==null||Object.keys(r).length===0){const i="[Sprig] - Disregarding empty attributes provided";return console.warn(i),{success:!1,message:i}}return this.identifyAndSetAttributes({attributes:r})},async identifyAndSetAttributes(r){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig identifyAndSetAttributes",r),e.mode==="test")return;if(r===null||typeof r!="object"||!(r.userId||r.anonymousId||r.attributes)){const u="[Sprig] - Disregarding empty payload provided";return console.warn(u),{success:!1,message:u}}const{userId:i,anonymousId:s,attributes:o}=r;if(e.requireUserIdForTracking&&!window.UserLeap.userId&&!i){const u="[Sprig] - Skipping tracking without userId";return console.warn(u),{success:!1,message:u}}if(!o&&(!i||window.UserLeap.userId===i)&&(!s||window.UserLeap.partnerAnonymousId===s))return{success:!0};const a={};i&&(a.userId=window.UserLeap.userId=i),s&&(a.partnerAnonymousId=window.UserLeap.partnerAnonymousId=s);let c;return o?(o.email&&!Object.prototype.hasOwnProperty.call(o,Lt)&&(o[Lt]=o.email,delete o.email),c=await Ue(we("1",[Fe,Me],"attributes"),{body:JSON.stringify(o),method:"PUT"}),!c.ok&&c.reportError&&(console.warn("[Sprig] (ERR-432) identifyAndSetAttributes failed",c.error),c.error&&window.UserLeap.reportError("identifyAndSetAttributes",c.error))):c=await Ue(we("1",[Fe,Me]),{body:JSON.stringify(a),method:"PUT"}),o&&o[Lt]&&(window.UserLeap.email=o[Lt]),c.ok&&(i&&ee("uid",i),s&&ee("aid",s)),{success:!!c.ok}},async removeAttributes(r){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig removeAttributes",r),e.mode==="test")return;if(r==null||r.length===0){const s="[Sprig] - Disregarding empty attributes provided";return console.warn(s),{success:!1,message:s}}if(e.requireUserIdForTracking&&!window.UserLeap.userId){const s="[Sprig] - Skipping tracking without userId";return console.warn(s),{success:!1,message:s}}const i=await Ue(we("1",[Fe,Me],"attributes"),{body:JSON.stringify({delete:r}),method:"DELETE"});return!i.ok&&i.reportError&&(console.warn("[Sprig] (ERR-433) Remove attributes failed",i.error),i.error&&window.UserLeap.reportError("removeAttributes",i.error)),{success:!!i.ok}},async addSurveyListener(r){P.on(O.SurveyLifeCycle,r)},async removeSurveyListener(r){P.removeListener(O.SurveyLifeCycle,r)},async addListener(r,i){P.on(r,i)},async removeListener(r,i){P.removeListener(r,i)},async removeAllListeners(){P.removeAllListeners()},setPreviewKey(r){!r||typeof r!="string"||J.isStorageAvailable&&r&&J.setItem(Q.Preview,r)},async setUserId(r){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig setUserId",r),r==null){const o=`[Sprig] - Invalid userId ${r}`;return console.warn(o),{success:!1,message:o}}if(e.mode==="test"||r===window.UserLeap.userId)return;window.UserLeap.userId=r;const i=window.UserLeap.visitorId,s=await Ue(we("1",[Fe,Me]),{body:JSON.stringify({userId:r}),method:"PUT"});if(!s.ok){s.reportError&&(console.warn("[Sprig] (ERR-420) Failed to set user id",s.error),s.error&&window.UserLeap.reportError("setUserId",s.error));return}i!==window.UserLeap.visitorId&&Fi(),ee("uid",r)},async setPartnerAnonymousId(r){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig setPartnerAnonymousId",r),r==null){const i=`[Sprig] - Invalid partnerAnonymousId ${r}`;return console.warn(i),{success:!1,message:i}}return window.UserLeap.partnerAnonymousId=r,ee("aid",r),{success:!0}},async track(r,i,s={},o=void 0){return t({eventName:r,properties:i,metadata:s,showSurveyCallback:o})},async identifyAndTrack(r){return await t(r)},trackPageView(r,i=void 0,s=void 0){Qi(r,i,s)},applyStyles(r){if(window.UserLeap.customStyles=r,window.UserLeap.container){const i=window.UserLeap.container.children[0].contentDocument;if(i){const s=i.getElementById(Ot.CustomStyle);s?s.textContent=r:ws(i,r,window.UserLeap.styleNonce)}}},setWindowDimensions(r,i){var c,u;const s=typeof r=="string"?parseInt(r,10):r,o=typeof i=="string"?parseInt(i,10):i;if(!isNaN(s)&&!isNaN(o)&&(window.UserLeap.windowDimensions={width:s,height:o}),!window.UserLeap.frameId)return;const a=document.getElementById(window.UserLeap.frameId);a&&(window.UserLeap.useMobileStyling&&((c=window.UserLeap.windowDimensions)!=null&&c.width&&(a.style.width=`${window.UserLeap.windowDimensions.width}px`),(u=window.UserLeap.windowDimensions)!=null&&u.height&&(a.style.maxHeight=`${window.UserLeap.windowDimensions.height-20}px`),a.contentDocument&&(a.style.height=String(vs(a.contentDocument)[0])+"px")),P.emit(O.SurveyDimensions,{name:O.SurveyDimensions,contentFrameWidth:a.clientWidth,contentFrameHeight:a.clientHeight}))},logoutUser(){window.UserLeap.debugMode&&console.info("[DEBUG] Sprig logout"),window.UserLeap.visitorId=null,window.UserLeap.userId=null,window.UserLeap.partnerAnonymousId=null,window.UserLeap.token=null,window.UserLeap.email=null,J.removeItem(Q.Credentials),J.removeItem(Q.PageViews),window.UserLeap._queue.isPaused()&&window.UserLeap._queue.empty(),Yi(),Fi(),window.UserLeap._queue.unpause()},teardown(){xa(),window.UserLeap("dismissActiveSurvey",Ae.API),delete window.UserLeap,delete window.Sprig,delete window._Sprig},integrateOptimizely(r,i=!0){var s,o;if(!((o=(s=window.UserLeap)==null?void 0:s._config)!=null&&o.optimizelyEnabled)){console.warn("[SPRIG] Optimizely integration is currently not enabled for your product.");return}try{const a=typeof r=="string"?JSON.parse(r):r;At.setOptimizelyExperiment(a,i)}catch(a){console.warn("[Sprig] Error with integrating Optimizely data"),a instanceof Error&&window.UserLeap.reportError("integrateOptimizely",a)}},integrateOptimizelyClient(r){var s,o;if(!((o=(s=window.UserLeap)==null?void 0:s._config)!=null&&o.optimizelyEnabled)){console.warn("[SPRIG] Optimizely integration is currently not enabled for your product.");return}const i=({experiment:a,variation:c})=>{const u={experiments:[{id:a.id,variation:c.key}]};window.UserLeap("integrateOptimizely",u,!1)};r.notificationCenter.addNotificationListener("ACTIVATE:experiment, user_id,attributes, variation, event",i)},importLaunchDarklyData(r){var i,s;if(!((s=(i=window.UserLeap)==null?void 0:i._config)!=null&&s.launchDarklyEnabled)){console.warn("[SPRIG] LaunchDarkly integration is currently not enabled for your product.");return}cn.setLDFlagsVariations(r)},setVisitorAttribute(r,i){return console.warn("[Sprig] setVisitorAttribute is deprecated. Please use setAttribute"),n.setAttribute(r,i)},async setEmail(r){return n.setAttribute(Lt,r)},async setVisitorEmail(r){return console.warn("[Sprig] setVisitorEmail is deprecated. Please use setEmail"),n.setEmail(r)},async _generateVideoUploadUrl(r){return Na(r)},async _completeSessionReplay({surveyId:r,responseGroupUuid:i,eventDigest:s}){if(!r||!i)return;const o=window.UserLeap._API_URL;try{await jr({surveyId:r,responseGroupUuid:i,eventDigest:s,apiUrl:o,headers:ze(window.UserLeap)},!0)}catch(a){console.warn("[Sprig] Error with completing session replay"),a instanceof Error&&window.UserLeap.reportError("completeSessionReplay",a)}}};Object.assign(window.UserLeap,n)};async function Ka(e){const t=ze(window.UserLeap);document.addEventListener("securitypolicyviolation",ln);const n=await He(we("1",[Fe],"config"),{headers:t}),r="TypeError";if(window.UserLeap.error=n.error,!n.ok&&n.error&&n.error.name===r?(window.UserLeap._API_URL="https://api.sprig.com",window.UserLeap.reportError("sprigDomainRequest",n.error)):document.removeEventListener("securitypolicyviolation",ln),!n.ok)return n.reportError&&(console.warn("[Sprig] (ERR-422) Failed to load configuration",n.error),n.error&&window.UserLeap.reportError("applyRemoteConfig",n.error)),un("Disabled: failed to fetch configuration"),e;const i=n.json;return i!=null&&i.disabled?(un(`Disabled: ${i.disabled}`),{disabled:i.disabled}):Object.assign({},i,e)}const ja=e=>typeof e=="object"&&e&&"inner"in e&&!!e.inner&&typeof e.inner=="object";async function Ba(e,t,n={}){var h,d;const r=window.__cfg&&window.__cfg.mode,i=hr(),s=window.UserLeap.envId,o=window.document.documentElement,a=ja(t)?{inner:{message:(h=t.inner)==null?void 0:h.message,stack:(d=t.inner)==null?void 0:d.stack}}:{},c={mode:r,screenWidth:window.screen.width,screenHeight:window.screen.height,clientWidth:o.clientWidth,clientHeight:o.clientHeight,location:window.location.href,language:window.navigator.language,...n,...a},u={action:e,err:{message:t.message,stack:t.stack},meta:c,vid:i,envId:s};(await Ue(we("1",null,"errors"),{method:"POST",headers:{[se.Error]:window.btoa(`userleap-${Date.now()}-error`)},body:JSON.stringify(u)},0,!0)).ok||console.warn("[Sprig] (ERR-444) Failed to report error to API",t)}async function Na(e){var n;if(!e)return;const t=`${window.UserLeap._API_URL}/2/environments/integrations/upload`;try{const r=await fetch(t,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok){const i=await r.json();return(n=i==null?void 0:i.upload)==null?void 0:n.url}else return null}catch(r){console.warn("[Sprig] Error with generating video upload url"),r instanceof Error&&window.UserLeap.reportError("generateVideoUploadUrl",r)}}function Fa(e={}){const t=new URLSearchParams(window.location.search).get(kr.Preview)??"";window.UserLeap.UPDATES=wr,window.UserLeap("setPreviewKey",t);async function n(){if(window.UserLeap.loaded)return;if(window.UserLeap.reportError=Ba,window.UserLeap.loaded=!0,window.UserLeap._config=Object.assign({},e,window.UserLeap.config),window.UserLeap.delayingSurvey=!1,window.UserLeap._config&&typeof window.UserLeap._config=="object")for(const a in window.UserLeap._config)window.UserLeap[a]=window.UserLeap._config[a];if(!window.UserLeap.envId)if(window.UserLeap.appId)window.UserLeap.envId=window.UserLeap.appId;else throw new Error("Missing Environment id");window.UserLeap.debugMode&&console.info("[DEBUG] Sprig debug mode enabled");const r=window.UserLeap.sampleRate;if(r){let a=Ve("sampled");if(a===null&&(a=Math.random()<r,ee("sampled",a)),!a)return}else Ve("sampled")!==null&&ee("sampled",null);window.UserLeap._API_URL||(window.UserLeap._API_URL="https://api.sprig.com");const i=[...window.UserLeap._queue];window.UserLeap._queue=new ps(window.UserLeap,[]),window.UserLeap._queue.pause();for(let a=0;a<i.length;a++)window.UserLeap._queue.push(i[a]);const s=Ve("token");s?(window.UserLeap.token=s,window.UserLeap.visitorId=Ve("vid"),window.UserLeap.userId=Ve("uid"),window.UserLeap.partnerAnonymousId=Ve("aid")):(J.removeItem(Q.Credentials),Yi());const o=await Ka(e);Ho(window.document,o.maxReplayDurationSeconds,window.UserLeap.replayNonce,window.UserLeap.maxInflightReplayRequests,o.replaySettings).then(()=>{_a()}),Ta(o),await Da(o),window.UserLeap._queue.unpause(),P.emit(O.SDKReady,{maxMobileReplayDurationSeconds:o.maxMobileReplayDurationSeconds,mobileReplaySettings:o.mobileReplaySettings}),P.emit(O.VisitorIDUpdated,{visitorId:window.UserLeap.visitorId})}document.readyState==="complete"?n():window.attachEvent?window.attachEvent("onload",n):window.addEventListener("load",()=>{n()},!1)}const Ma="sprig-web-view-sdk";let Xi;Xi={path:`https://cdn.sprig.com/${Ma}-v2.26.2.js`},Fa(Xi)})();
//# sourceMappingURL=shim.js.map
